{"version":3,"file":"index.mjs","names":["errors: string[]","warnings: string[]","_prisma: PrismaClient | undefined","transporter: nodemailer.Transporter | null","error: any","ms: number","user: AuthUser","matchedUser: { id: string; email: string } | null","matchedUser: { id: string } | null","user: AuthUser | undefined","apiKey: ApiKeyInfo | undefined","bearer","authService.register","authService.login","authService.googleAuth","bearer","authService.validateSession","authService.logout","authService.logoutAll","authService.getUserSessions","authService.deleteSession","authService.changePassword","authService.resendVerificationEmail","authService.requestPasswordReset","authService.resetPassword","authService.verifyEmail","sendTestEmail","where: any","getAuthUser","userService.getUserById","userService.updateProfile","userService.getUserStats","userService.getAllUsers","userService.updateUserRole","userService.toggleUserStatus","userService.updateUserPassword","userService.deleteUser","apiKeyService.getUserApiKeys","apiKeyService.createApiKey","apiKeyService.getApiKey","apiKeyService.updateApiKeyPermissions","apiKeyService.revokeApiKey","apiKeyService.rotateApiKey","apiKeyService.deleteApiKey","where: any","getAuthUser","vendorService.getAllVendors","vendorService.getAllCategories","vendorService.getVendorById","vendorService.getVendorByUserId","vendorService.createVendor","vendorService.updateVendor","vendorService.toggleVendorStatus","vendorService.getVendorStats","vendorService.deleteVendor","where: any","getAuthUser","menuService.getMenuItemById","menuService.updateMenuItem","menuService.toggleMenuItemAvailability","menuService.deleteMenuItem","menuService.getVendorMenuItems","menuService.getVendorCategories","menuService.createMenuItem","menuService.bulkUpdateAvailability","updateData: any","where: any","getAuthUser","reservationService.createReservation","reservationService.getCustomerReservations","reservationService.getReservationById","reservationService.cancelReservation","reservationService.updateReservationStatus","reservationService.getAllReservations","reservationService.getReservationStats","reservationService.getVendorReservations","timeSlotService.getTimeSlots","timeSlotService.getAvailableTimeSlots","timeSlotService.getTimeSlotById","timeSlotService.createTimeSlot","timeSlotService.updateTimeSlot","timeSlotService.deleteTimeSlot","folderOptions: Record<UploadFolder, UploadApiOptions>","options: UploadApiOptions","result: UploadApiResponse","typeToFolder: Record<UploadType, UploadFolder>","where: any","getAuthUser","uploadService.uploadFile","uploadService.uploadAvatar","uploadService.uploadVendorImage","uploadService.uploadMenuItemImage","uploadService.getUserUploads","uploadService.getUploadById","uploadService.deleteUpload","where: any","orderBy: any","reviewService.getRecentReviews","reviewService.getTopRatedVendors","reviewService.getReviewById","reviewService.createReview","reviewService.updateReview","reviewService.deleteReview","reviewService.getUserReviews","reviewService.canUserReviewVendor","reviewService.getAllReviews","reviewService.getVendorReviews","reviewService.getVendorReviewStats"],"sources":["../src/config/env.ts","../src/config/database.ts","../src/utils/crypto.ts","../src/utils/errors.ts","../src/services/audit.service.ts","../src/services/email.service.ts","../src/services/auth.service.ts","../src/middlewares/auth.middleware.ts","../src/utils/response.ts","../src/utils/validation.ts","../src/controllers/auth.controller.ts","../src/services/user.service.ts","../src/controllers/user.controller.ts","../src/services/apikey.service.ts","../src/controllers/apikey.controller.ts","../src/services/vendor.service.ts","../src/controllers/vendor.controller.ts","../src/services/menu.service.ts","../src/controllers/menu.controller.ts","../src/services/reservation.service.ts","../src/controllers/reservation.controller.ts","../src/services/timeslot.service.ts","../src/controllers/timeslot.controller.ts","../src/config/cloudinary.ts","../src/services/upload.service.ts","../src/controllers/upload.controller.ts","../src/services/review.service.ts","../src/controllers/review.controller.ts","../src/index.ts"],"sourcesContent":["// Environment Configuration\n// Validates and exports all environment variables with production security checks\n\n// List of insecure default values that must not be used in production\nconst INSECURE_JWT_SECRETS = [\n  'dev-secret-key-change-in-production',\n  'secret',\n  'jwt-secret',\n  'changeme',\n  'password',\n  '123456',\n];\n\nconst getEnv = (key: string, defaultValue?: string): string => {\n  const value = process.env[key] || defaultValue;\n  if (!value) {\n    throw new Error(`Missing required environment variable: ${key}`);\n  }\n  return value;\n};\n\n// Get optional environment variable (allows empty string)\nconst getEnvOptional = (key: string, defaultValue: string = ''): string => {\n  const value = process.env[key];\n  return value !== undefined ? value : defaultValue;\n};\n\nconst getEnvNumber = (key: string, defaultValue?: number): number => {\n  const value = process.env[key];\n  if (value) return parseInt(value, 10);\n  if (defaultValue !== undefined) return defaultValue;\n  throw new Error(`Missing required environment variable: ${key}`);\n};\n\nconst getEnvBoolean = (key: string, defaultValue: boolean = false): boolean => {\n  const value = process.env[key];\n  if (value === undefined) return defaultValue;\n  return value.toLowerCase() === 'true';\n};\n\n// Production security validation\nfunction validateProductionSecurity(): void {\n  const isProduction = getEnv('NODE_ENV', 'development') === 'production';\n\n  if (!isProduction) {\n    console.warn('\\n[Security] Running in development mode - security checks relaxed\\n');\n    return;\n  }\n\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Validate JWT_SECRET\n  const jwtSecret = process.env.JWT_SECRET;\n  if (!jwtSecret) {\n    errors.push('JWT_SECRET is required in production');\n  } else {\n    // Check against insecure defaults\n    if (INSECURE_JWT_SECRETS.includes(jwtSecret.toLowerCase())) {\n      errors.push('JWT_SECRET is using an insecure default value - please set a secure secret');\n    }\n\n    // Check minimum length (32 characters)\n    if (jwtSecret.length < 32) {\n      errors.push('JWT_SECRET must be at least 32 characters long');\n    }\n\n    // Check entropy (basic check)\n    const uniqueChars = new Set(jwtSecret).size;\n    if (uniqueChars < 10) {\n      warnings.push('JWT_SECRET has low character variety - consider using a more random value');\n    }\n  }\n\n  // Validate FRONTEND_URL\n  const frontendUrl = process.env.FRONTEND_URL;\n  if (!frontendUrl || frontendUrl.includes('localhost')) {\n    errors.push('FRONTEND_URL must be set to production URL (not localhost)');\n  }\n\n  // Validate DATABASE_URL\n  const databaseUrl = process.env.DATABASE_URL;\n  if (!databaseUrl) {\n    errors.push('DATABASE_URL is required');\n  }\n\n  // Check SMTP for email features\n  if (!process.env.SMTP_HOST) {\n    warnings.push('SMTP_HOST not configured - email features will not work');\n  }\n\n  // Print warnings\n  if (warnings.length > 0) {\n    console.warn('\\n[Production Security Warnings]');\n    warnings.forEach((w) => console.warn(`  - ${w}`));\n  }\n\n  // Throw errors if any critical issues\n  if (errors.length > 0) {\n    console.error('\\n[CRITICAL: Production Security Errors]');\n    errors.forEach((e) => console.error(`  - ${e}`));\n    console.error('\\nApplication cannot start with insecure configuration.');\n    console.error('Please fix the above issues before deploying to production.\\n');\n    process.exit(1);\n  }\n\n  console.log('[Security] Production security validation passed\\n');\n}\n\n// Run validation on module load\nvalidateProductionSecurity();\n\nexport const env = {\n  // Server\n  PORT: getEnvNumber('PORT', 3001),\n  NODE_ENV: getEnv('NODE_ENV', 'development'),\n  IS_PRODUCTION: getEnv('NODE_ENV', 'development') === 'production',\n\n  // Database\n  DATABASE_URL: getEnv('DATABASE_URL'),\n\n  // JWT - No insecure defaults in production (checked above)\n  JWT_SECRET: getEnv('JWT_SECRET', 'dev-secret-key-change-in-production'),\n  JWT_EXPIRES_IN: getEnv('JWT_EXPIRES_IN', '7d'),\n\n  // Google OAuth (optional)\n  GOOGLE_CLIENT_ID: getEnvOptional('GOOGLE_CLIENT_ID'),\n  GOOGLE_CLIENT_SECRET: getEnvOptional('GOOGLE_CLIENT_SECRET'),\n  GOOGLE_CALLBACK_URL: getEnvOptional(\n    'GOOGLE_CALLBACK_URL',\n    'http://localhost:3001/api/auth/google/callback'\n  ),\n\n  // Cloudinary (optional)\n  CLOUDINARY_CLOUD_NAME: getEnvOptional('CLOUDINARY_CLOUD_NAME'),\n  CLOUDINARY_API_KEY: getEnvOptional('CLOUDINARY_API_KEY'),\n  CLOUDINARY_API_SECRET: getEnvOptional('CLOUDINARY_API_SECRET'),\n\n  // Frontend\n  FRONTEND_URL: getEnv('FRONTEND_URL', 'http://localhost:3000'),\n\n  // API Key\n  API_KEY_PREFIX: getEnv('API_KEY_PREFIX', 'rk_'),\n  API_KEY_LENGTH: getEnvNumber('API_KEY_LENGTH', 32),\n\n  // Rate Limiting\n  RATE_LIMIT_WINDOW_MS: getEnvNumber('RATE_LIMIT_WINDOW_MS', 60000),\n  RATE_LIMIT_MAX_REQUESTS: getEnvNumber('RATE_LIMIT_MAX_REQUESTS', 100),\n\n  // Logging\n  LOG_LEVEL: getEnv('LOG_LEVEL', 'info'),\n\n  // Account Security\n  ACCOUNT_LOCKOUT_THRESHOLD: getEnvNumber('ACCOUNT_LOCKOUT_THRESHOLD', 5),\n  ACCOUNT_LOCKOUT_DURATION_MINUTES: getEnvNumber('ACCOUNT_LOCKOUT_DURATION_MINUTES', 30),\n\n  // Token Expiry\n  PASSWORD_RESET_TOKEN_EXPIRES_HOURS: getEnvNumber('PASSWORD_RESET_TOKEN_EXPIRES_HOURS', 1),\n  EMAIL_VERIFICATION_TOKEN_EXPIRES_HOURS: getEnvNumber('EMAIL_VERIFICATION_TOKEN_EXPIRES_HOURS', 24),\n\n  // SMTP Email (optional - if not configured, emails are logged to console)\n  SMTP_HOST: getEnvOptional('SMTP_HOST'),\n  SMTP_PORT: getEnvNumber('SMTP_PORT', 587),\n  SMTP_USER: getEnvOptional('SMTP_USER'),\n  SMTP_PASS: getEnvOptional('SMTP_PASS'),\n  SMTP_FROM: getEnvOptional('SMTP_FROM', 'noreply@example.com'),\n  SMTP_SECURE: getEnvBoolean('SMTP_SECURE', false),\n} as const;\n\nexport type Env = typeof env;\n","// Database Configuration\n// Prisma Client Singleton for Bun Runtime with Prisma 7\n\nimport { PrismaClient } from '@prisma/client';\nimport { PrismaPg } from '@prisma/adapter-pg';\nimport pg from 'pg';\nimport { env } from './env';\n\ndeclare global {\n  var prisma: PrismaClient | undefined;\n}\n\n// Lazy initialization - don't create connection on import\nlet _prisma: PrismaClient | undefined;\n\nexport function getPrisma(): PrismaClient {\n  if (!_prisma) {\n    const pool = new pg.Pool({ connectionString: env.DATABASE_URL });\n    const adapter = new PrismaPg(pool);\n    _prisma = new PrismaClient({\n      adapter,\n      log: ['error'],\n    });\n  }\n  return _prisma;\n}\n\n// For backward compatibility - lazy getter\nexport const prisma = new Proxy({} as PrismaClient, {\n  get(_, prop) {\n    return (getPrisma() as any)[prop];\n  },\n});\n\nexport default prisma;\n","// Cryptography Utilities\nimport { nanoid } from 'nanoid';\nimport bcrypt from 'bcryptjs';\nimport { env } from '../config/env';\n\n/**\n * Generate a secure random ID\n */\nexport function generateId(length: number = 21): string {\n  return nanoid(length);\n}\n\n/**\n * Generate API Key\n */\nexport function generateApiKey(): { key: string; prefix: string } {\n  const key = `${env.API_KEY_PREFIX}${nanoid(env.API_KEY_LENGTH)}`;\n  const prefix = key.substring(0, 8);\n  return { key, prefix };\n}\n\n/**\n * Hash password\n */\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12);\n}\n\n/**\n * Compare password with hash\n */\nexport async function comparePassword(\n  password: string,\n  hash: string\n): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\n/**\n * Generate session token\n */\nexport function generateSessionToken(): string {\n  return nanoid(64);\n}\n\n/**\n * Generate queue number for a specific date\n */\nexport function generateQueueNumber(vendorId: string, date: Date): number {\n  // In production, this should query the database to get the next queue number\n  // For now, we use timestamp-based generation\n  const dateString = date.toISOString().split('T')[0];\n  const timestamp = Date.now();\n  return parseInt(`${timestamp}`.slice(-4), 10);\n}\n","// Custom Error Classes\n\nexport class AppError extends Error {\n  public statusCode: number;\n  public code: string;\n  public isOperational: boolean;\n\n  constructor(\n    message: string,\n    statusCode: number = 500,\n    code: string = 'INTERNAL_ERROR'\n  ) {\n    super(message);\n    this.statusCode = statusCode;\n    this.code = code;\n    this.isOperational = true;\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\nexport class NotFoundError extends AppError {\n  constructor(resource: string = 'Resource') {\n    super(`${resource} not found`, 404, 'NOT_FOUND');\n  }\n}\n\nexport class UnauthorizedError extends AppError {\n  constructor(message: string = 'Unauthorized') {\n    super(message, 401, 'UNAUTHORIZED');\n  }\n}\n\nexport class ForbiddenError extends AppError {\n  constructor(message: string = 'Forbidden') {\n    super(message, 403, 'FORBIDDEN');\n  }\n}\n\nexport class BadRequestError extends AppError {\n  constructor(message: string = 'Bad request') {\n    super(message, 400, 'BAD_REQUEST');\n  }\n}\n\nexport class ValidationError extends AppError {\n  public errors: Record<string, string[]>;\n\n  constructor(errors: Record<string, string[]>) {\n    super('Validation failed', 422, 'VALIDATION_ERROR');\n    this.errors = errors;\n  }\n}\n\nexport class ConflictError extends AppError {\n  constructor(message: string = 'Resource already exists') {\n    super(message, 409, 'CONFLICT');\n  }\n}\n\nexport class RateLimitError extends AppError {\n  constructor(message: string = 'Too many requests') {\n    super(message, 429, 'RATE_LIMIT_EXCEEDED');\n  }\n}\n\n// Error response formatter\nexport function formatErrorResponse(error: unknown) {\n  if (error instanceof ValidationError) {\n    return {\n      success: false,\n      error: error.message,\n      code: error.code,\n      details: error.errors,\n    };\n  }\n\n  if (error instanceof AppError) {\n    return {\n      success: false,\n      error: error.message,\n      code: error.code,\n    };\n  }\n\n  // Unknown error\n  console.error('Unexpected error:', error);\n  return {\n    success: false,\n    error: 'An unexpected error occurred',\n    code: 'INTERNAL_ERROR',\n  };\n}\n\n// Get status code from error\nexport function getErrorStatusCode(error: unknown): number {\n  if (error instanceof AppError) {\n    return error.statusCode;\n  }\n  return 500;\n}\n","// Audit Logging Service\n// Records all authentication and security-related events\n\nimport { prisma } from '../config/database';\n\n// Audit action types\nexport type AuditAction =\n  | 'LOGIN_SUCCESS'\n  | 'LOGIN_FAILED'\n  | 'LOGIN_BLOCKED_LOCKOUT'\n  | 'LOGOUT'\n  | 'LOGOUT_ALL'\n  | 'REGISTER'\n  | 'PASSWORD_CHANGED'\n  | 'PASSWORD_RESET_REQUESTED'\n  | 'PASSWORD_RESET_COMPLETED'\n  | 'EMAIL_VERIFIED'\n  | 'EMAIL_VERIFICATION_SENT'\n  | 'ACCOUNT_LOCKED'\n  | 'ACCOUNT_UNLOCKED'\n  | 'ACCOUNT_DISABLED'\n  | 'ACCOUNT_ENABLED'\n  | 'ADMIN_CREATED'\n  | 'ROLE_CHANGED'\n  | 'SESSION_CREATED'\n  | 'SESSION_DELETED'\n  | 'API_KEY_CREATED'\n  | 'API_KEY_REVOKED'\n  | 'OAUTH_LOGIN'\n  | 'OAUTH_LINK';\n\nexport interface AuditLogData {\n  userId?: string;\n  apiKeyId?: string;\n  action: AuditAction;\n  entity: string;\n  entityId?: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  metadata?: any;\n  ipAddress?: string;\n  userAgent?: string;\n}\n\n/**\n * Create an audit log entry\n * This function is non-blocking and will not throw errors to avoid disrupting the main flow\n */\nexport async function createAuditLog(data: AuditLogData): Promise<void> {\n  try {\n    await prisma.auditLog.create({\n      data: {\n        userId: data.userId,\n        apiKeyId: data.apiKeyId,\n        action: data.action,\n        entity: data.entity,\n        entityId: data.entityId,\n        metadata: data.metadata,\n        ipAddress: data.ipAddress,\n        userAgent: data.userAgent,\n      },\n    });\n  } catch (err) {\n    // Don't throw - audit logging should not break the main flow\n    console.error('[AuditLog] Failed to create log:', err);\n  }\n}\n\n/**\n * Query audit logs with filters\n */\nexport async function getAuditLogs(options: {\n  userId?: string;\n  action?: AuditAction;\n  entity?: string;\n  startDate?: Date;\n  endDate?: Date;\n  page?: number;\n  limit?: number;\n}) {\n  const { userId, action, entity, startDate, endDate, page = 1, limit = 50 } = options;\n\n  const where: Record<string, unknown> = {};\n\n  if (userId) where.userId = userId;\n  if (action) where.action = action;\n  if (entity) where.entity = entity;\n  if (startDate || endDate) {\n    where.createdAt = {};\n    if (startDate) (where.createdAt as Record<string, unknown>).gte = startDate;\n    if (endDate) (where.createdAt as Record<string, unknown>).lte = endDate;\n  }\n\n  const [logs, total] = await Promise.all([\n    prisma.auditLog.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n      skip: (page - 1) * limit,\n      take: limit,\n      include: {\n        user: { select: { email: true, name: true } },\n      },\n    }),\n    prisma.auditLog.count({ where }),\n  ]);\n\n  return {\n    logs,\n    pagination: {\n      page,\n      limit,\n      total,\n      totalPages: Math.ceil(total / limit),\n    },\n  };\n}\n\n/**\n * Get recent security events for a user\n */\nexport async function getUserSecurityEvents(userId: string, limit: number = 10) {\n  const securityActions: AuditAction[] = [\n    'LOGIN_SUCCESS',\n    'LOGIN_FAILED',\n    'LOGIN_BLOCKED_LOCKOUT',\n    'LOGOUT',\n    'PASSWORD_CHANGED',\n    'PASSWORD_RESET_COMPLETED',\n    'ACCOUNT_LOCKED',\n  ];\n\n  return prisma.auditLog.findMany({\n    where: {\n      userId,\n      action: { in: securityActions },\n    },\n    orderBy: { createdAt: 'desc' },\n    take: limit,\n    select: {\n      id: true,\n      action: true,\n      ipAddress: true,\n      userAgent: true,\n      createdAt: true,\n      metadata: true,\n    },\n  });\n}\n\n/**\n * Get failed login attempts count for monitoring\n */\nexport async function getFailedLoginAttempts(\n  email: string,\n  since: Date\n): Promise<number> {\n  return prisma.auditLog.count({\n    where: {\n      action: 'LOGIN_FAILED',\n      entity: 'User',\n      metadata: {\n        path: ['email'],\n        equals: email,\n      },\n      createdAt: { gte: since },\n    },\n  });\n}\n\n/**\n * Clean up old audit logs (retention policy)\n */\nexport async function cleanupOldAuditLogs(retentionDays: number = 90): Promise<number> {\n  const cutoffDate = new Date();\n  cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n  const result = await prisma.auditLog.deleteMany({\n    where: {\n      createdAt: { lt: cutoffDate },\n    },\n  });\n\n  return result.count;\n}\n","// Email Service\n// Handles sending emails for verification, password reset, etc.\n// Optimized for Gmail SMTP with anti-spam best practices\n\nimport nodemailer from 'nodemailer';\nimport { env } from '../config/env';\nimport { randomUUID } from 'crypto';\n\ninterface EmailOptions {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n}\n\n// Create reusable transporter\nlet transporter: nodemailer.Transporter | null = null;\n\n// Get the sender email - for Gmail, must match SMTP_USER\nfunction getSenderEmail(): string {\n  // Gmail requires the from address to match the authenticated user\n  // or be an alias configured in Gmail settings\n  if (env.SMTP_HOST === 'smtp.gmail.com') {\n    return env.SMTP_USER || env.SMTP_FROM || 'noreply@example.com';\n  }\n  return env.SMTP_FROM || env.SMTP_USER || 'noreply@example.com';\n}\n\nfunction getTransporter(): nodemailer.Transporter | null {\n  if (transporter) return transporter;\n\n  // Check if SMTP is configured\n  if (!env.SMTP_HOST || !env.SMTP_USER || !env.SMTP_PASS) {\n    return null;\n  }\n\n  // Gmail-specific configuration for reliable delivery\n  const isGmail = env.SMTP_HOST === 'smtp.gmail.com';\n\n  transporter = nodemailer.createTransport({\n    host: env.SMTP_HOST,\n    port: env.SMTP_PORT,\n    secure: env.SMTP_SECURE, // true for 465, false for other ports\n    auth: {\n      user: env.SMTP_USER,\n      pass: env.SMTP_PASS,\n    },\n    // Connection pool for better performance\n    pool: true,\n    maxConnections: 5,\n    maxMessages: 100,\n    // Gmail-specific settings\n    ...(isGmail && {\n      // Increase timeouts for Gmail\n      connectionTimeout: 10000,\n      greetingTimeout: 10000,\n      socketTimeout: 15000,\n    }),\n    // TLS settings\n    tls: {\n      rejectUnauthorized: true,\n      minVersion: 'TLSv1.2',\n    },\n  });\n\n  // Verify connection on startup\n  transporter.verify((error) => {\n    if (error) {\n      console.error('[Email Service] SMTP connection failed:', error.message);\n    } else {\n      console.log('[Email Service] SMTP server is ready to send emails');\n    }\n  });\n\n  return transporter;\n}\n\n/**\n * Generate a unique Message-ID for email tracking\n */\nfunction generateMessageId(): string {\n  const domain = getSenderEmail().split('@')[1] || 'foodqueue.local';\n  return `<${randomUUID()}@${domain}>`;\n}\n\n/**\n * Send an email\n * In development without SMTP config, logs to console instead\n * Includes anti-spam headers for better deliverability\n */\nexport async function sendEmail(options: EmailOptions): Promise<boolean> {\n  const transport = getTransporter();\n  const senderEmail = getSenderEmail();\n  const senderName = 'Food Queue Reservation';\n\n  // If no SMTP configured, log to console (development mode)\n  if (!transport) {\n    console.log('\\n[Email Service - No SMTP Configured]');\n    console.log(`To: ${options.to}`);\n    console.log(`Subject: ${options.subject}`);\n    console.log(`Body:\\n${options.text || options.html}\\n`);\n    return true; // Return success for development\n  }\n\n  try {\n    const messageId = generateMessageId();\n\n    await transport.sendMail({\n      // From with display name - improves trust\n      from: `\"${senderName}\" <${senderEmail}>`,\n      to: options.to,\n      subject: options.subject,\n      html: options.html,\n      text: options.text,\n      // Important headers for anti-spam\n      messageId: messageId,\n      headers: {\n        // Precedence header to indicate transactional email\n        'Precedence': 'bulk',\n        // Auto-submitted header to indicate automated email\n        'Auto-Submitted': 'auto-generated',\n        // X-Mailer to identify the sending application\n        'X-Mailer': 'Food Queue Reservation System',\n        // List-Unsubscribe header (recommended for better deliverability)\n        'List-Unsubscribe': `<mailto:${senderEmail}?subject=unsubscribe>`,\n      },\n      // Reply-to same as sender for consistency\n      replyTo: senderEmail,\n    });\n\n    console.log(`[Email Service] Email sent successfully to ${options.to}`);\n    return true;\n  } catch (error) {\n    console.error('[Email Service] Failed to send email:', error);\n    return false;\n  }\n}\n\n/**\n * Send email verification link\n */\nexport async function sendVerificationEmail(\n  email: string,\n  name: string,\n  token: string\n): Promise<boolean> {\n  const verifyUrl = `${env.FRONTEND_URL}/verify-email?token=${token}`;\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£',\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <title>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #f97316, #ea580c); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üçú ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö!</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 40px 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 22px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name} üëã</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á:</p>\n\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\n                      <tr>\n                        <td align=\"center\" style=\"padding: 30px 0;\">\n                          <a href=\"${verifyUrl}\" style=\"display: inline-block; background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; padding: 16px 40px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 14px rgba(249,115,22,0.4);\">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</a>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <p style=\"margin: 20px 0 10px; color: #6b7280; font-size: 14px;\">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå:</p>\n                    <p style=\"margin: 0 0 20px; padding: 12px; background-color: #f3f4f6; border-radius: 6px; word-break: break-all; font-size: 13px; color: #4b5563;\">${verifyUrl}</p>\n\n                    <div style=\"margin: 25px 0; padding: 15px; background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;\">\n                      <p style=\"margin: 0; color: #92400e; font-size: 14px;\">‚è∞ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô ${env.EMAIL_VERIFICATION_TOKEN_EXPIRES_HOURS} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>\n                    </div>\n\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 13px;\">‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡∏Å‡πÄ‡∏â‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name},\\n\\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£!\\n\\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå:\\n${verifyUrl}\\n\\n‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô ${env.EMAIL_VERIFICATION_TOKEN_EXPIRES_HOURS} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á\\n\\n‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡∏Å‡πÄ‡∏â‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ\\n\\n---\\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£`,\n  });\n}\n\n/**\n * Send password reset link\n */\nexport async function sendPasswordResetEmail(\n  email: string,\n  name: string,\n  token: string\n): Promise<boolean> {\n  const resetUrl = `${env.FRONTEND_URL}/reset-password?token=${token}`;\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£',\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <title>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #f97316, #ea580c); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üîê ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 40px 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 22px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name}</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:</p>\n\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\n                      <tr>\n                        <td align=\"center\" style=\"padding: 30px 0;\">\n                          <a href=\"${resetUrl}\" style=\"display: inline-block; background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; padding: 16px 40px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 14px rgba(249,115,22,0.4);\">üîë ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</a>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <p style=\"margin: 20px 0 10px; color: #6b7280; font-size: 14px;\">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå:</p>\n                    <p style=\"margin: 0 0 20px; padding: 12px; background-color: #f3f4f6; border-radius: 6px; word-break: break-all; font-size: 13px; color: #4b5563;\">${resetUrl}</p>\n\n                    <div style=\"margin: 25px 0; padding: 15px; background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;\">\n                      <p style=\"margin: 0; color: #92400e; font-size: 14px;\">‚è∞ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô ${env.PASSWORD_RESET_TOKEN_EXPIRES_HOURS} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>\n                    </div>\n\n                    <div style=\"margin: 25px 0; padding: 15px; background-color: #fef2f2; border-left: 4px solid #ef4444; border-radius: 4px;\">\n                      <p style=\"margin: 0; color: #991b1b; font-size: 14px;\"><strong>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong> ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡∏Å‡πÄ‡∏â‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°</p>\n                    </div>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name},\\n\\n‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì\\n\\n‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:\\n${resetUrl}\\n\\n‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô ${env.PASSWORD_RESET_TOKEN_EXPIRES_HOURS} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á\\n\\n‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡∏Å‡πÄ‡∏â‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ\\n\\n---\\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£`,\n  });\n}\n\n/**\n * Send account locked notification\n */\n/**\n * Send a test email to verify SMTP configuration\n */\nexport async function sendTestEmail(email: string): Promise<{ success: boolean; message: string }> {\n  const transport = getTransporter();\n  const senderEmail = getSenderEmail();\n  const currentYear = new Date().getFullYear();\n\n  if (!transport) {\n    return {\n      success: false,\n      message: 'SMTP not configured. Please set SMTP_HOST, SMTP_USER, and SMTP_PASS in .env file.',\n    };\n  }\n\n  try {\n    const result = await transport.sendMail({\n      from: `\"Food Queue Reservation\" <${senderEmail}>`,\n      to: email,\n      subject: '‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£',\n      messageId: generateMessageId(),\n      headers: {\n        'Precedence': 'bulk',\n        'Auto-Submitted': 'auto-generated',\n        'X-Mailer': 'Food Queue Reservation System',\n      },\n      replyTo: senderEmail,\n      html: `\n        <!DOCTYPE html>\n        <html lang=\"th\">\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•</title>\n        </head>\n        <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n          <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n            <tr>\n              <td align=\"center\" style=\"padding: 40px 20px;\">\n                <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                  <tr>\n                    <td style=\"background: linear-gradient(135deg, #22c55e, #16a34a); padding: 40px 30px; text-align: center;\">\n                      <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h1>\n                      <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</p>\n                    </td>\n                  </tr>\n                  <tr>\n                    <td style=\"padding: 40px 30px; text-align: center;\">\n                      <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SMTP</p>\n                      <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 14px;\">‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å: <strong>${senderEmail}</strong></p>\n                      <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 14px;\">‡πÄ‡∏ß‡∏•‡∏≤: <strong>${new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })}</strong></p>\n                      <div style=\"margin: 25px 0; padding: 15px; background-color: #dcfce7; border-left: 4px solid #22c55e; border-radius: 4px;\">\n                        <p style=\"margin: 0; color: #166534; font-size: 14px;\">üéâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!</p>\n                      </div>\n                    </td>\n                  </tr>\n                  <tr>\n                    <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                      <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>\n                    </td>\n                  </tr>\n                </table>\n              </td>\n            </tr>\n          </table>\n        </body>\n        </html>\n      `,\n      text: `‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\\n\\n‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SMTP\\n‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å: ${senderEmail}\\n‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })}\\n\\n‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`,\n    });\n\n    console.log('[Email Service] Test email sent successfully:', result.messageId);\n    return {\n      success: true,\n      message: `Test email sent successfully to ${email}. Message ID: ${result.messageId}`,\n    };\n  } catch (error: any) {\n    console.error('[Email Service] Test email failed:', error);\n    return {\n      success: false,\n      message: `Failed to send test email: ${error.message || 'Unknown error'}`,\n    };\n  }\n}\n\n// ===================================================\n// Order Status Notification Emails\n// ===================================================\n\ninterface OrderDetails {\n  queueNumber: number;\n  vendorName: string;\n  customerName: string;\n  items: { name: string; quantity: number; price: number }[];\n  totalAmount: number;\n  timeSlot?: string;\n}\n\n/**\n * Generate order items table HTML\n */\nfunction generateOrderItemsHtml(items: OrderDetails['items']): string {\n  return items.map(item => `\n    <tr>\n      <td style=\"padding: 10px 15px; border-bottom: 1px solid #e5e7eb;\">${item.name}</td>\n      <td style=\"padding: 10px 15px; border-bottom: 1px solid #e5e7eb; text-align: center;\">${item.quantity}</td>\n      <td style=\"padding: 10px 15px; border-bottom: 1px solid #e5e7eb; text-align: right;\">‡∏ø${(item.price * item.quantity).toLocaleString()}</td>\n    </tr>\n  `).join('');\n}\n\n/**\n * Send order confirmed email\n */\nexport async function sendOrderConfirmedEmail(\n  email: string,\n  order: OrderDetails\n): Promise<boolean> {\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: `‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ #${order.queueNumber} - ${order.vendorName}`,\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #22c55e, #16a34a); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">${order.vendorName}</p>\n                  </td>\n                </tr>\n                <!-- Queue Number -->\n                <tr>\n                  <td style=\"padding: 30px; text-align: center; background-color: #f0fdf4;\">\n                    <p style=\"margin: 0 0 5px; color: #166534; font-size: 14px;\">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>\n                    <p style=\"margin: 0; color: #166534; font-size: 48px; font-weight: bold;\">#${order.queueNumber}</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 18px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${order.customerName}</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>\n\n                    ${order.timeSlot ? `\n                    <div style=\"margin: 0 0 20px; padding: 15px; background-color: #fef3c7; border-radius: 8px;\">\n                      <p style=\"margin: 0; color: #92400e; font-size: 14px;\">‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£: <strong>${order.timeSlot}</strong></p>\n                    </div>\n                    ` : ''}\n\n                    <!-- Order Items -->\n                    <h3 style=\"margin: 20px 0 15px; color: #1f2937; font-size: 16px;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f9fafb; border-radius: 8px; overflow: hidden;\">\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <th style=\"padding: 12px 15px; text-align: left; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>\n                        <th style=\"padding: 12px 15px; text-align: center; font-size: 14px; color: #4b5563;\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>\n                        <th style=\"padding: 12px 15px; text-align: right; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏Ñ‡∏≤</th>\n                      </tr>\n                      ${generateOrderItemsHtml(order.items)}\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <td colspan=\"2\" style=\"padding: 12px 15px; font-weight: bold; color: #1f2937;\">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>\n                        <td style=\"padding: 12px 15px; text-align: right; font-weight: bold; color: #f97316; font-size: 18px;\">‡∏ø${order.totalAmount.toLocaleString()}</td>\n                      </tr>\n                    </table>\n\n                    <div style=\"margin: 25px 0; padding: 15px; background-color: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 4px;\">\n                      <p style=\"margin: 0; color: #1e40af; font-size: 14px;\">üì± ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö</p>\n                    </div>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!\\n\\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß: #${order.queueNumber}\\n‡∏£‡πâ‡∏≤‡∏ô: ${order.vendorName}\\n${order.timeSlot ? `‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö: ${order.timeSlot}\\n` : ''}\\n‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡∏ø${order.totalAmount.toLocaleString()}\\n\\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£`,\n  });\n}\n\n/**\n * Send order preparing email\n */\nexport async function sendOrderPreparingEmail(\n  email: string,\n  order: OrderDetails\n): Promise<boolean> {\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: `üç≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${order.queueNumber} - ${order.vendorName}`,\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #f97316, #ea580c); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üç≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">${order.vendorName}</p>\n                  </td>\n                </tr>\n                <!-- Queue Number -->\n                <tr>\n                  <td style=\"padding: 30px; text-align: center; background-color: #fff7ed;\">\n                    <p style=\"margin: 0 0 5px; color: #c2410c; font-size: 14px;\">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß</p>\n                    <p style=\"margin: 0; color: #c2410c; font-size: 48px; font-weight: bold;\">#${order.queueNumber}</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 18px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${order.customerName}</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>\n\n                    <div style=\"margin: 20px 0; padding: 20px; background-color: #fef3c7; border-radius: 8px; text-align: center;\">\n                      <p style=\"margin: 0; color: #92400e; font-size: 16px;\">‚è±Ô∏è <strong>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°...</strong></p>\n                      <p style=\"margin: 10px 0 0; color: #a16207; font-size: 14px;\">‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö</p>\n                    </div>\n\n                    <!-- Order Items -->\n                    <h3 style=\"margin: 20px 0 15px; color: #1f2937; font-size: 16px;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°</h3>\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f9fafb; border-radius: 8px; overflow: hidden;\">\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <th style=\"padding: 12px 15px; text-align: left; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>\n                        <th style=\"padding: 12px 15px; text-align: center; font-size: 14px; color: #4b5563;\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>\n                        <th style=\"padding: 12px 15px; text-align: right; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏Ñ‡∏≤</th>\n                      </tr>\n                      ${generateOrderItemsHtml(order.items)}\n                    </table>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£!\\n\\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß: #${order.queueNumber}\\n‡∏£‡πâ‡∏≤‡∏ô: ${order.vendorName}\\n\\n‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö`,\n  });\n}\n\n/**\n * Send order ready email\n */\nexport async function sendOrderReadyEmail(\n  email: string,\n  order: OrderDetails\n): Promise<boolean> {\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: `üéâ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${order.queueNumber} ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß! - ${order.vendorName}`,\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #10b981, #059669); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üéâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß!</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">${order.vendorName}</p>\n                  </td>\n                </tr>\n                <!-- Queue Number -->\n                <tr>\n                  <td style=\"padding: 30px; text-align: center; background-color: #ecfdf5;\">\n                    <p style=\"margin: 0 0 5px; color: #047857; font-size: 14px;\">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß</p>\n                    <p style=\"margin: 0; color: #047857; font-size: 56px; font-weight: bold;\">#${order.queueNumber}</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 18px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${order.customerName}</h2>\n\n                    <div style=\"margin: 0 0 25px; padding: 20px; background-color: #dcfce7; border: 2px solid #22c55e; border-radius: 8px; text-align: center;\">\n                      <p style=\"margin: 0; color: #166534; font-size: 20px; font-weight: bold;\">üîî ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!</p>\n                      <p style=\"margin: 10px 0 0; color: #15803d; font-size: 16px;\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô <strong>${order.vendorName}</strong></p>\n                    </div>\n\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß <strong>#${order.queueNumber}</strong> ‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>\n\n                    <!-- Order Items -->\n                    <h3 style=\"margin: 20px 0 15px; color: #1f2937; font-size: 16px;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f9fafb; border-radius: 8px; overflow: hidden;\">\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <th style=\"padding: 12px 15px; text-align: left; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>\n                        <th style=\"padding: 12px 15px; text-align: center; font-size: 14px; color: #4b5563;\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>\n                        <th style=\"padding: 12px 15px; text-align: right; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏Ñ‡∏≤</th>\n                      </tr>\n                      ${generateOrderItemsHtml(order.items)}\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <td colspan=\"2\" style=\"padding: 12px 15px; font-weight: bold; color: #1f2937;\">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>\n                        <td style=\"padding: 12px 15px; text-align: right; font-weight: bold; color: #f97316; font-size: 18px;\">‡∏ø${order.totalAmount.toLocaleString()}</td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `üéâ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß!\\n\\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß: #${order.queueNumber}\\n‡∏£‡πâ‡∏≤‡∏ô: ${order.vendorName}\\n\\n‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô\\n‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß #${order.queueNumber} ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£`,\n  });\n}\n\n/**\n * Send order completed email with review reminder\n */\nexport async function sendOrderCompletedEmail(\n  email: string,\n  order: OrderDetails,\n  reviewUrl?: string\n): Promise<boolean> {\n  const currentYear = new Date().getFullYear();\n  const defaultReviewUrl = `${env.FRONTEND_URL}/reviews`;\n\n  return sendEmail({\n    to: email,\n    subject: `üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ - ‡∏£‡πâ‡∏≤‡∏ô ${order.vendorName}`,\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£!</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">${order.vendorName}</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 18px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${order.customerName}</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${order.queueNumber} ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£!</p>\n\n                    <!-- Order Summary -->\n                    <div style=\"margin: 0 0 25px; padding: 20px; background-color: #f3f4f6; border-radius: 8px;\">\n                      <p style=\"margin: 0 0 10px; color: #4b5563; font-size: 14px;\">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>\n                      <p style=\"margin: 0; color: #1f2937; font-size: 24px; font-weight: bold;\">‡∏ø${order.totalAmount.toLocaleString()}</p>\n                    </div>\n\n                    <!-- Review CTA -->\n                    <div style=\"margin: 25px 0; padding: 25px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; text-align: center;\">\n                      <p style=\"margin: 0 0 15px; color: #92400e; font-size: 18px; font-weight: bold;\">‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</p>\n                      <p style=\"margin: 0 0 20px; color: #a16207; font-size: 14px;\">‡πÅ‡∏ä‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô</p>\n                      <a href=\"${reviewUrl || defaultReviewUrl}\" style=\"display: inline-block; background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; padding: 14px 35px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 14px rgba(249,115,22,0.4);\">‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>\n                    </div>\n\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 13px; text-align: center;\">‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏û‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!</p>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£!\\n\\n‡∏£‡πâ‡∏≤‡∏ô: ${order.vendorName}\\n‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: #${order.queueNumber}\\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ‡∏ø${order.totalAmount.toLocaleString()}\\n\\n‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤: ${reviewUrl || defaultReviewUrl}\\n\\n‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏û‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!`,\n  });\n}\n\n/**\n * Send order cancelled email\n */\nexport async function sendOrderCancelledEmail(\n  email: string,\n  order: OrderDetails,\n  reason?: string\n): Promise<boolean> {\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: `‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ #${order.queueNumber} - ${order.vendorName}`,\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #ef4444, #dc2626); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">‚ùå ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">${order.vendorName}</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 18px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${order.customerName}</h2>\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ #${order.queueNumber} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>\n\n                    ${reason ? `\n                    <div style=\"margin: 0 0 25px; padding: 15px; background-color: #fef2f2; border-left: 4px solid #ef4444; border-radius: 4px;\">\n                      <p style=\"margin: 0; color: #991b1b; font-size: 14px;\"><strong>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</strong> ${reason}</p>\n                    </div>\n                    ` : ''}\n\n                    <!-- Order Items -->\n                    <h3 style=\"margin: 20px 0 15px; color: #1f2937; font-size: 16px;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</h3>\n                    <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f9fafb; border-radius: 8px; overflow: hidden; opacity: 0.7;\">\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <th style=\"padding: 12px 15px; text-align: left; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>\n                        <th style=\"padding: 12px 15px; text-align: center; font-size: 14px; color: #4b5563;\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>\n                        <th style=\"padding: 12px 15px; text-align: right; font-size: 14px; color: #4b5563;\">‡∏£‡∏≤‡∏Ñ‡∏≤</th>\n                      </tr>\n                      ${generateOrderItemsHtml(order.items)}\n                      <tr style=\"background-color: #f3f4f6;\">\n                        <td colspan=\"2\" style=\"padding: 12px 15px; font-weight: bold; color: #1f2937; text-decoration: line-through;\">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>\n                        <td style=\"padding: 12px 15px; text-align: right; font-weight: bold; color: #9ca3af; font-size: 18px; text-decoration: line-through;\">‡∏ø${order.totalAmount.toLocaleString()}</td>\n                      </tr>\n                    </table>\n\n                    <p style=\"margin: 25px 0 0; color: #6b7280; font-size: 14px; text-align: center;\">‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</p>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‚ùå ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\\n\\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß: #${order.queueNumber}\\n‡∏£‡πâ‡∏≤‡∏ô: ${order.vendorName}\\n${reason ? `‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${reason}\\n` : ''}\\n‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ‡∏ø${order.totalAmount.toLocaleString()}`,\n  });\n}\n\nexport async function sendAccountLockedEmail(\n  email: string,\n  name: string,\n  lockedUntil: Date\n): Promise<boolean> {\n  const unlockTime = lockedUntil.toLocaleString('th-TH', {\n    timeZone: 'Asia/Bangkok',\n    dateStyle: 'medium',\n    timeStyle: 'short',\n  });\n  const currentYear = new Date().getFullYear();\n\n  return sendEmail({\n    to: email,\n    subject: 'üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ - ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß',\n    html: `\n      <!DOCTYPE html>\n      <html lang=\"th\">\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <title>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333333; background-color: #f4f4f4;\">\n        <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"background-color: #f4f4f4;\">\n          <tr>\n            <td align=\"center\" style=\"padding: 40px 20px;\">\n              <table role=\"presentation\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n                <!-- Header -->\n                <tr>\n                  <td style=\"background: linear-gradient(135deg, #dc2626, #b91c1c); padding: 40px 30px; text-align: center;\">\n                    <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h1>\n                    <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 16px;\">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</p>\n                  </td>\n                </tr>\n                <!-- Content -->\n                <tr>\n                  <td style=\"padding: 40px 30px;\">\n                    <h2 style=\"margin: 0 0 20px; color: #1f2937; font-size: 22px;\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name}</h2>\n\n                    <div style=\"margin: 0 0 25px; padding: 20px; background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 8px;\">\n                      <p style=\"margin: 0; color: #991b1b; font-size: 16px; font-weight: bold;\">‚ö†Ô∏è ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</p>\n                      <p style=\"margin: 10px 0 0; color: #7f1d1d; font-size: 14px;\">‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>\n                    </div>\n\n                    <p style=\"margin: 0 0 20px; color: #4b5563; font-size: 16px;\">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:</p>\n                    <p style=\"margin: 0 0 25px; padding: 15px; background-color: #f3f4f6; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; color: #1f2937;\">${unlockTime}</p>\n\n                    <p style=\"margin: 0 0 15px; color: #4b5563; font-size: 16px;\">‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ:</p>\n                    <ul style=\"margin: 0 0 25px; padding-left: 20px; color: #4b5563;\">\n                      <li style=\"margin-bottom: 8px;\">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</li>\n                      <li style=\"margin-bottom: 8px;\">‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô</li>\n                      <li style=\"margin-bottom: 8px;\">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</li>\n                    </ul>\n\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 13px;\">‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</p>\n                  </td>\n                </tr>\n                <!-- Footer -->\n                <tr>\n                  <td style=\"padding: 30px; background-color: #f9fafb; text-align: center; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"margin: 0 0 10px; color: #6b7280; font-size: 14px;\">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - Food Queue Reservation</p>\n                    <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">¬© ${currentYear} ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n        </table>\n      </body>\n      </html>\n    `,\n    text: `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${name},\\n\\n‚ö†Ô∏è ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß\\n\\n‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á\\n\\n‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤: ${unlockTime}\\n\\n‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ\\n\\n---\\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏´‡∏≤‡∏£`,\n  });\n}\n","// Authentication Service\nimport { prisma } from '../config/database';\nimport { env } from '../config/env';\nimport { hashPassword, comparePassword, generateSessionToken } from '../utils/crypto';\nimport { UnauthorizedError, ConflictError, BadRequestError } from '../utils/errors';\nimport { createAuditLog } from './audit.service';\nimport {\n  sendVerificationEmail,\n  sendPasswordResetEmail,\n  sendAccountLockedEmail,\n} from './email.service';\nimport type { RegisterInput, LoginInput } from '../utils/validation';\nimport type { Role } from '@prisma/client';\nimport { nanoid } from 'nanoid';\n\nexport interface AuthUser {\n  id: string;\n  email: string;\n  name: string;\n  phone: string | null;\n  avatar: string | null;\n  role: Role;\n  createdAt: Date;\n}\n\nexport interface SessionData {\n  user: AuthUser;\n  token: string;\n  expiresAt: Date;\n}\n\n// Calculate session expiry\nfunction getSessionExpiry(): Date {\n  const expiresIn = env.JWT_EXPIRES_IN;\n  const match = expiresIn.match(/^(\\d+)([dhms])$/);\n  if (!match) {\n    return new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n  }\n\n  const value = parseInt(match[1], 10);\n  const unit = match[2];\n\n  let ms: number;\n  switch (unit) {\n    case 'd':\n      ms = value * 24 * 60 * 60 * 1000;\n      break;\n    case 'h':\n      ms = value * 60 * 60 * 1000;\n      break;\n    case 'm':\n      ms = value * 60 * 1000;\n      break;\n    case 's':\n      ms = value * 1000;\n      break;\n    default:\n      ms = 7 * 24 * 60 * 60 * 1000;\n  }\n\n  return new Date(Date.now() + ms);\n}\n\n// ============================================\n// Account Lockout Functions\n// ============================================\n\n/**\n * Check if account is locked\n */\nasync function checkAccountLockout(user: {\n  id: string;\n  email: string;\n  lockedUntil: Date | null;\n}): Promise<void> {\n  if (user.lockedUntil && user.lockedUntil > new Date()) {\n    const remainingMinutes = Math.ceil((user.lockedUntil.getTime() - Date.now()) / 60000);\n\n    await createAuditLog({\n      userId: user.id,\n      action: 'LOGIN_BLOCKED_LOCKOUT',\n      entity: 'User',\n      entityId: user.id,\n      metadata: { remainingMinutes, email: user.email },\n    });\n\n    throw new UnauthorizedError(\n      `Account is locked due to too many failed login attempts. Please try again in ${remainingMinutes} minute(s).`\n    );\n  }\n}\n\n/**\n * Record a failed login attempt\n */\nasync function recordFailedLogin(userId: string, email: string): Promise<void> {\n  const user = await prisma.user.update({\n    where: { id: userId },\n    data: {\n      failedLoginAttempts: { increment: 1 },\n      lastFailedLogin: new Date(),\n    },\n    select: { failedLoginAttempts: true, name: true },\n  });\n\n  await createAuditLog({\n    userId,\n    action: 'LOGIN_FAILED',\n    entity: 'User',\n    entityId: userId,\n    metadata: { email, failedAttempts: user.failedLoginAttempts },\n  });\n\n  // Check if should lock account\n  if (user.failedLoginAttempts >= env.ACCOUNT_LOCKOUT_THRESHOLD) {\n    const lockUntil = new Date(Date.now() + env.ACCOUNT_LOCKOUT_DURATION_MINUTES * 60 * 1000);\n\n    await prisma.user.update({\n      where: { id: userId },\n      data: { lockedUntil: lockUntil },\n    });\n\n    await createAuditLog({\n      userId,\n      action: 'ACCOUNT_LOCKED',\n      entity: 'User',\n      entityId: userId,\n      metadata: {\n        failedAttempts: user.failedLoginAttempts,\n        lockedUntil: lockUntil.toISOString(),\n      },\n    });\n\n    // Send notification email\n    await sendAccountLockedEmail(email, user.name, lockUntil);\n  }\n}\n\n/**\n * Reset failed login attempts on successful login\n */\nasync function resetFailedLoginAttempts(userId: string): Promise<void> {\n  await prisma.user.update({\n    where: { id: userId },\n    data: {\n      failedLoginAttempts: 0,\n      lockedUntil: null,\n      lastFailedLogin: null,\n    },\n  });\n}\n\n// ============================================\n// Core Authentication Functions\n// ============================================\n\n/**\n * Register a new user\n */\nexport async function register(input: RegisterInput): Promise<SessionData> {\n  const existingUser = await prisma.user.findUnique({\n    where: { email: input.email },\n  });\n\n  if (existingUser) {\n    throw new ConflictError('User with this email already exists');\n  }\n\n  const hashedPassword = await hashPassword(input.password);\n\n  const user = await prisma.user.create({\n    data: {\n      email: input.email,\n      name: input.name,\n      phone: input.phone,\n      password: hashedPassword,\n      role: input.role as Role,\n      emailVerified: false,\n    },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      createdAt: true,\n    },\n  });\n\n  // Generate and send email verification\n  const verificationToken = await generateEmailVerificationToken(user.id);\n  await sendVerificationEmail(user.email, user.name, verificationToken);\n\n  await createAuditLog({\n    userId: user.id,\n    action: 'REGISTER',\n    entity: 'User',\n    entityId: user.id,\n    metadata: { email: user.email, role: user.role },\n  });\n\n  return createSession(user);\n}\n\n/**\n * Login with email and password\n */\nexport async function login(input: LoginInput): Promise<SessionData> {\n  const user = await prisma.user.findUnique({\n    where: { email: input.email },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      password: true,\n      isActive: true,\n      lockedUntil: true,\n      failedLoginAttempts: true,\n      createdAt: true,\n    },\n  });\n\n  // Prevent timing attacks - always do password comparison\n  if (!user) {\n    await comparePassword(input.password, '$2a$12$invalidhashfortimingattak');\n    throw new UnauthorizedError('Invalid email or password');\n  }\n\n  // Check account lockout\n  await checkAccountLockout(user);\n\n  if (!user.password) {\n    throw new UnauthorizedError('Invalid email or password');\n  }\n\n  const isValid = await comparePassword(input.password, user.password);\n  if (!isValid) {\n    await recordFailedLogin(user.id, user.email);\n    throw new UnauthorizedError('Invalid email or password');\n  }\n\n  if (!user.isActive) {\n    throw new UnauthorizedError('Account is disabled');\n  }\n\n  // Reset failed attempts on successful login\n  await resetFailedLoginAttempts(user.id);\n\n  await createAuditLog({\n    userId: user.id,\n    action: 'LOGIN_SUCCESS',\n    entity: 'User',\n    entityId: user.id,\n    metadata: { email: user.email },\n  });\n\n  return createSession({\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    phone: user.phone,\n    avatar: user.avatar,\n    role: user.role,\n    createdAt: user.createdAt,\n  });\n}\n\n/**\n * Login/Register with Google OAuth\n */\nexport async function googleAuth(\n  googleUser: {\n    id: string;\n    email: string;\n    name: string;\n    picture?: string;\n  },\n  tokens: {\n    accessToken: string;\n    refreshToken?: string;\n    expiresAt?: number;\n  }\n): Promise<SessionData> {\n  let account = await prisma.account.findUnique({\n    where: {\n      provider_providerAccountId: {\n        provider: 'google',\n        providerAccountId: googleUser.id,\n      },\n    },\n    include: { user: true },\n  });\n\n  let user: AuthUser;\n\n  if (account) {\n    await prisma.account.update({\n      where: { id: account.id },\n      data: {\n        accessToken: tokens.accessToken,\n        refreshToken: tokens.refreshToken,\n        expiresAt: tokens.expiresAt,\n      },\n    });\n\n    user = {\n      id: account.user.id,\n      email: account.user.email,\n      name: account.user.name,\n      phone: account.user.phone,\n      avatar: account.user.avatar,\n      role: account.user.role,\n      createdAt: account.user.createdAt,\n    };\n\n    await createAuditLog({\n      userId: user.id,\n      action: 'OAUTH_LOGIN',\n      entity: 'User',\n      entityId: user.id,\n      metadata: { provider: 'google' },\n    });\n  } else {\n    const existingUser = await prisma.user.findUnique({\n      where: { email: googleUser.email },\n    });\n\n    if (existingUser) {\n      await prisma.account.create({\n        data: {\n          userId: existingUser.id,\n          type: 'oauth',\n          provider: 'google',\n          providerAccountId: googleUser.id,\n          accessToken: tokens.accessToken,\n          refreshToken: tokens.refreshToken,\n          expiresAt: tokens.expiresAt,\n        },\n      });\n\n      user = {\n        id: existingUser.id,\n        email: existingUser.email,\n        name: existingUser.name,\n        phone: existingUser.phone,\n        avatar: existingUser.avatar || googleUser.picture || null,\n        role: existingUser.role,\n        createdAt: existingUser.createdAt,\n      };\n\n      if (!existingUser.avatar && googleUser.picture) {\n        await prisma.user.update({\n          where: { id: existingUser.id },\n          data: { avatar: googleUser.picture, emailVerified: true },\n        });\n      }\n\n      await createAuditLog({\n        userId: user.id,\n        action: 'OAUTH_LINK',\n        entity: 'User',\n        entityId: user.id,\n        metadata: { provider: 'google' },\n      });\n    } else {\n      const newUser = await prisma.user.create({\n        data: {\n          email: googleUser.email,\n          name: googleUser.name,\n          avatar: googleUser.picture,\n          emailVerified: true,\n          accounts: {\n            create: {\n              type: 'oauth',\n              provider: 'google',\n              providerAccountId: googleUser.id,\n              accessToken: tokens.accessToken,\n              refreshToken: tokens.refreshToken,\n              expiresAt: tokens.expiresAt,\n            },\n          },\n        },\n      });\n\n      user = {\n        id: newUser.id,\n        email: newUser.email,\n        name: newUser.name,\n        phone: newUser.phone,\n        avatar: newUser.avatar,\n        role: newUser.role,\n        createdAt: newUser.createdAt,\n      };\n\n      await createAuditLog({\n        userId: user.id,\n        action: 'REGISTER',\n        entity: 'User',\n        entityId: user.id,\n        metadata: { provider: 'google', email: user.email },\n      });\n    }\n  }\n\n  return createSession(user);\n}\n\n// ============================================\n// Session Management\n// ============================================\n\n/**\n * Create a new session for user\n */\nasync function createSession(user: AuthUser): Promise<SessionData> {\n  const token = generateSessionToken();\n  const expiresAt = getSessionExpiry();\n\n  await prisma.session.create({\n    data: {\n      userId: user.id,\n      token,\n      expiresAt,\n    },\n  });\n\n  return { user, token, expiresAt };\n}\n\n/**\n * Validate session token and return user\n */\nexport async function validateSession(token: string): Promise<AuthUser | null> {\n  const session = await prisma.session.findUnique({\n    where: { token },\n    include: { user: true },\n  });\n\n  if (!session) {\n    return null;\n  }\n\n  if (session.expiresAt < new Date()) {\n    await prisma.session.delete({ where: { id: session.id } });\n    return null;\n  }\n\n  if (!session.user.isActive) {\n    return null;\n  }\n\n  await prisma.session.update({\n    where: { id: session.id },\n    data: { lastActiveAt: new Date() },\n  });\n\n  return {\n    id: session.user.id,\n    email: session.user.email,\n    name: session.user.name,\n    phone: session.user.phone,\n    avatar: session.user.avatar,\n    role: session.user.role,\n    createdAt: session.user.createdAt,\n  };\n}\n\n/**\n * Logout - delete session\n */\nexport async function logout(token: string, userId?: string): Promise<void> {\n  await prisma.session.deleteMany({\n    where: { token },\n  });\n\n  if (userId) {\n    await createAuditLog({\n      userId,\n      action: 'LOGOUT',\n      entity: 'User',\n      entityId: userId,\n    });\n  }\n}\n\n/**\n * Logout all sessions for a user\n */\nexport async function logoutAll(userId: string): Promise<void> {\n  await prisma.session.deleteMany({\n    where: { userId },\n  });\n\n  await createAuditLog({\n    userId,\n    action: 'LOGOUT_ALL',\n    entity: 'User',\n    entityId: userId,\n  });\n}\n\n/**\n * Get user sessions\n */\nexport async function getUserSessions(userId: string) {\n  return prisma.session.findMany({\n    where: { userId },\n    select: {\n      id: true,\n      createdAt: true,\n      lastActiveAt: true,\n      userAgent: true,\n      ipAddress: true,\n    },\n    orderBy: { lastActiveAt: 'desc' },\n  });\n}\n\n/**\n * Delete specific session\n */\nexport async function deleteSession(userId: string, sessionId: string): Promise<void> {\n  await prisma.session.deleteMany({\n    where: { id: sessionId, userId },\n  });\n\n  await createAuditLog({\n    userId,\n    action: 'SESSION_DELETED',\n    entity: 'Session',\n    entityId: sessionId,\n  });\n}\n\n// ============================================\n// Email Verification\n// ============================================\n\n/**\n * Generate email verification token\n */\nasync function generateEmailVerificationToken(userId: string): Promise<string> {\n  const token = nanoid(64);\n  const expires = new Date(Date.now() + env.EMAIL_VERIFICATION_TOKEN_EXPIRES_HOURS * 60 * 60 * 1000);\n\n  // Store hashed token for security\n  const hashedToken = await hashPassword(token);\n\n  await prisma.user.update({\n    where: { id: userId },\n    data: {\n      emailVerificationToken: hashedToken,\n      emailVerificationExpires: expires,\n    },\n  });\n\n  return token;\n}\n\n/**\n * Verify email with token\n */\nexport async function verifyEmail(token: string): Promise<void> {\n  // Find users with pending verification\n  const users = await prisma.user.findMany({\n    where: {\n      emailVerified: false,\n      emailVerificationToken: { not: null },\n      emailVerificationExpires: { gt: new Date() },\n    },\n    select: {\n      id: true,\n      email: true,\n      emailVerificationToken: true,\n    },\n  });\n\n  // Find matching token\n  let matchedUser: { id: string; email: string } | null = null;\n  for (const user of users) {\n    if (user.emailVerificationToken) {\n      const isValid = await comparePassword(token, user.emailVerificationToken);\n      if (isValid) {\n        matchedUser = user;\n        break;\n      }\n    }\n  }\n\n  if (!matchedUser) {\n    throw new BadRequestError('Invalid or expired verification token');\n  }\n\n  await prisma.user.update({\n    where: { id: matchedUser.id },\n    data: {\n      emailVerified: true,\n      emailVerificationToken: null,\n      emailVerificationExpires: null,\n    },\n  });\n\n  await createAuditLog({\n    userId: matchedUser.id,\n    action: 'EMAIL_VERIFIED',\n    entity: 'User',\n    entityId: matchedUser.id,\n  });\n}\n\n/**\n * Resend verification email\n */\nexport async function resendVerificationEmail(userId: string): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { id: true, email: true, name: true, emailVerified: true },\n  });\n\n  if (!user) {\n    throw new BadRequestError('User not found');\n  }\n\n  if (user.emailVerified) {\n    throw new BadRequestError('Email is already verified');\n  }\n\n  const token = await generateEmailVerificationToken(user.id);\n  await sendVerificationEmail(user.email, user.name, token);\n\n  await createAuditLog({\n    userId: user.id,\n    action: 'EMAIL_VERIFICATION_SENT',\n    entity: 'User',\n    entityId: user.id,\n  });\n}\n\n// ============================================\n// Password Reset\n// ============================================\n\n/**\n * Request password reset\n */\nexport async function requestPasswordReset(email: string): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { email },\n    select: { id: true, email: true, name: true, password: true },\n  });\n\n  // Always return success to prevent email enumeration\n  if (!user) {\n    return;\n  }\n\n  // Only allow password reset for users with password (not OAuth-only)\n  if (!user.password) {\n    return;\n  }\n\n  const token = nanoid(64);\n  const expires = new Date(Date.now() + env.PASSWORD_RESET_TOKEN_EXPIRES_HOURS * 60 * 60 * 1000);\n\n  // Store hashed token\n  const hashedToken = await hashPassword(token);\n\n  await prisma.user.update({\n    where: { id: user.id },\n    data: {\n      passwordResetToken: hashedToken,\n      passwordResetExpires: expires,\n    },\n  });\n\n  await createAuditLog({\n    userId: user.id,\n    action: 'PASSWORD_RESET_REQUESTED',\n    entity: 'User',\n    entityId: user.id,\n  });\n\n  await sendPasswordResetEmail(user.email, user.name, token);\n}\n\n/**\n * Reset password with token\n */\nexport async function resetPassword(token: string, newPassword: string): Promise<void> {\n  // Find users with valid reset tokens\n  const users = await prisma.user.findMany({\n    where: {\n      passwordResetToken: { not: null },\n      passwordResetExpires: { gt: new Date() },\n    },\n    select: {\n      id: true,\n      passwordResetToken: true,\n    },\n  });\n\n  // Find matching token\n  let matchedUser: { id: string } | null = null;\n  for (const user of users) {\n    if (user.passwordResetToken) {\n      const isValid = await comparePassword(token, user.passwordResetToken);\n      if (isValid) {\n        matchedUser = user;\n        break;\n      }\n    }\n  }\n\n  if (!matchedUser) {\n    throw new BadRequestError('Invalid or expired reset token');\n  }\n\n  // Update password and clear reset token\n  const hashedPassword = await hashPassword(newPassword);\n\n  await prisma.user.update({\n    where: { id: matchedUser.id },\n    data: {\n      password: hashedPassword,\n      passwordResetToken: null,\n      passwordResetExpires: null,\n      failedLoginAttempts: 0,\n      lockedUntil: null,\n    },\n  });\n\n  // Invalidate all sessions (force re-login)\n  await prisma.session.deleteMany({\n    where: { userId: matchedUser.id },\n  });\n\n  await createAuditLog({\n    userId: matchedUser.id,\n    action: 'PASSWORD_RESET_COMPLETED',\n    entity: 'User',\n    entityId: matchedUser.id,\n  });\n}\n\n/**\n * Change password (for logged-in users)\n */\nexport async function changePassword(\n  userId: string,\n  currentPassword: string,\n  newPassword: string\n): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: { password: true },\n  });\n\n  if (!user?.password) {\n    throw new BadRequestError(\n      'Cannot change password for accounts that use only social login'\n    );\n  }\n\n  const isValid = await comparePassword(currentPassword, user.password);\n  if (!isValid) {\n    throw new UnauthorizedError('Current password is incorrect');\n  }\n\n  const hashedPassword = await hashPassword(newPassword);\n\n  await prisma.user.update({\n    where: { id: userId },\n    data: { password: hashedPassword },\n  });\n\n  await createAuditLog({\n    userId,\n    action: 'PASSWORD_CHANGED',\n    entity: 'User',\n    entityId: userId,\n  });\n}\n","// Authentication Middleware\nimport { Elysia } from 'elysia';\nimport { bearer } from '@elysiajs/bearer';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport { prisma } from '../config/database';\nimport { UnauthorizedError, ForbiddenError } from '../utils/errors';\nimport type { Role } from '@prisma/client';\n\n// Re-export AuthUser for convenience\nexport type { AuthUser } from '../services/auth.service';\n\n// Type for API Key\nexport interface ApiKeyInfo {\n  id: string;\n  name: string;\n  permissions: string[];\n}\n\n/**\n * Helper function to extract auth from request\n */\nasync function extractAuth(bearerToken: string | undefined, headers: Record<string, string | undefined>) {\n  let user: AuthUser | undefined;\n  let apiKey: ApiKeyInfo | undefined;\n\n  console.log('extractAuth called:', {\n    hasBearer: !!bearerToken,\n    bearerPrefix: bearerToken ? bearerToken.substring(0, 10) + '...' : null,\n    hasApiKey: !!headers['x-api-key'],\n  });\n\n  // Check for bearer token\n  if (bearerToken) {\n    const authUser = await validateSession(bearerToken);\n    console.log('Bearer validation result:', { hasUser: !!authUser });\n    if (authUser) {\n      user = authUser;\n    }\n  }\n\n  // Check for API key in header\n  const apiKeyHeader = headers['x-api-key'];\n  if (apiKeyHeader && !user) {\n    const key = await prisma.aPIKey.findFirst({\n      where: {\n        key: apiKeyHeader,\n        status: 'ACTIVE',\n        OR: [{ expiresAt: null }, { expiresAt: { gt: new Date() } }],\n      },\n      include: { user: true },\n    });\n\n    if (key) {\n      apiKey = {\n        id: key.id,\n        name: key.name,\n        permissions: key.permissions,\n      };\n\n      // Update last used\n      await prisma.aPIKey.update({\n        where: { id: key.id },\n        data: { lastUsedAt: new Date() },\n      });\n\n      user = {\n        id: key.user.id,\n        email: key.user.email,\n        name: key.user.name,\n        phone: key.user.phone,\n        avatar: key.user.avatar,\n        role: key.user.role,\n        createdAt: key.user.createdAt,\n      };\n    }\n  }\n\n  return { user, apiKey };\n}\n\n// Type for authenticated context\nexport type AuthenticatedContext = {\n  user: AuthUser;\n  apiKey: ApiKeyInfo | undefined;\n};\n\nexport type OptionalAuthContext = {\n  user: AuthUser | undefined;\n  apiKey: ApiKeyInfo | undefined;\n};\n\n/**\n * Auth plugin - validates bearer token or API key\n * Returns user and apiKey in context\n */\nexport const authPlugin = new Elysia({ name: 'auth' })\n  .use(bearer())\n  .derive(async ({ bearer, headers }) => {\n    console.log('=== authPlugin.derive START ===', { hasBearer: !!bearer });\n    const result = await extractAuth(bearer, headers);\n    console.log('=== authPlugin.derive END ===', { hasUser: !!result.user });\n    return result;\n  });\n\n/**\n * Require authentication - throws if not authenticated\n */\nexport const requireAuth = new Elysia({ name: 'requireAuth' })\n  .use(bearer())\n  .derive(async ({ bearer: bearerToken, headers, request }) => {\n    console.log('=== requireAuth.derive START ===', {\n      hasBearer: !!bearerToken,\n      bearerPrefix: bearerToken ? bearerToken.substring(0, 10) + '...' : null,\n    });\n\n    // Try to get bearer from Authorization header directly if not provided\n    let token = bearerToken;\n    if (!token) {\n      const authHeader = request.headers.get('authorization');\n      if (authHeader?.startsWith('Bearer ')) {\n        token = authHeader.slice(7);\n        console.log('Got token from header directly:', token.substring(0, 10) + '...');\n      }\n    }\n\n    const auth = await extractAuth(token, headers);\n    console.log('=== requireAuth.derive END ===', { hasUser: !!auth.user });\n\n    if (!auth.user) {\n      throw new UnauthorizedError('Authentication required');\n    }\n    return auth as AuthenticatedContext;\n  });\n\n/**\n * Require specific role(s)\n */\nexport function requireRole(...roles: Role[]) {\n  return new Elysia({ name: `requireRole:${roles.join(',')}` })\n    .use(bearer())\n    .derive(async ({ bearer, headers }) => {\n      const auth = await extractAuth(bearer, headers);\n      if (!auth.user) {\n        throw new UnauthorizedError('Authentication required');\n      }\n      if (!roles.includes(auth.user.role)) {\n        throw new ForbiddenError(`Required role: ${roles.join(' or ')}`);\n      }\n      return auth as AuthenticatedContext;\n    });\n}\n\n/**\n * Require admin role\n */\nexport const requireAdmin = requireRole('ADMIN');\n\n/**\n * Require vendor role\n */\nexport const requireVendor = requireRole('VENDOR');\n\n/**\n * Require vendor or admin role\n */\nexport const requireVendorOrAdmin = requireRole('VENDOR', 'ADMIN');\n\n/**\n * Optional auth - doesn't throw if not authenticated\n */\nexport const optionalAuth = authPlugin;\n\n/**\n * Check API key permission\n */\nexport function requireApiPermission(permission: string) {\n  return new Elysia({ name: `requireApiPermission:${permission}` })\n    .use(bearer())\n    .derive(async ({ bearer, headers }) => {\n      const auth = await extractAuth(bearer, headers);\n      if (!auth.user) {\n        throw new UnauthorizedError('Authentication required');\n      }\n      // If using API key, check permission\n      if (auth.apiKey && !auth.apiKey.permissions.includes(permission)) {\n        throw new ForbiddenError(`Missing permission: ${permission}`);\n      }\n      return auth as AuthenticatedContext;\n    });\n}\n","// Standard API Response Utilities\n\nexport interface ApiResponse<T = unknown> {\n  success: boolean;\n  data?: T;\n  message?: string;\n  error?: string;\n  code?: string;\n  meta?: {\n    page?: number;\n    limit?: number;\n    total?: number;\n    totalPages?: number;\n  };\n}\n\nexport interface PaginationParams {\n  page?: number;\n  limit?: number;\n}\n\nexport interface PaginatedResult<T> {\n  items: T[];\n  meta: {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n  };\n}\n\n/**\n * Create success response\n */\nexport function success<T>(data: T, message?: string): ApiResponse<T> {\n  return {\n    success: true,\n    data,\n    message,\n  };\n}\n\n/**\n * Create paginated success response\n */\nexport function paginated<T>(result: PaginatedResult<T>): ApiResponse<T[]> {\n  return {\n    success: true,\n    data: result.items,\n    meta: result.meta,\n  };\n}\n\n/**\n * Create error response\n */\nexport function error(\n  message: string,\n  code?: string,\n  statusCode: number = 400\n): Response {\n  return new Response(\n    JSON.stringify({\n      success: false,\n      error: message,\n      code,\n    }),\n    {\n      status: statusCode,\n      headers: { 'Content-Type': 'application/json' },\n    }\n  );\n}\n\n/**\n * Parse pagination params\n */\nexport function parsePagination(params: PaginationParams): {\n  page: number;\n  limit: number;\n  skip: number;\n} {\n  const page = Math.max(1, params.page || 1);\n  const limit = Math.min(100, Math.max(1, params.limit || 20));\n  const skip = (page - 1) * limit;\n\n  return { page, limit, skip };\n}\n\n/**\n * Create pagination meta\n */\nexport function createPaginationMeta(\n  page: number,\n  limit: number,\n  total: number\n) {\n  return {\n    page,\n    limit,\n    total,\n    totalPages: Math.ceil(total / limit),\n  };\n}\n","// Validation Schemas using Zod\nimport { z } from 'zod';\n\n// ===========================================\n// Common Schemas\n// ===========================================\n\nexport const idSchema = z.string().min(1, 'ID is required');\n\nexport const paginationSchema = z.object({\n  page: z.coerce.number().int().positive().optional().default(1),\n  limit: z.coerce.number().int().positive().max(100).optional().default(20),\n});\n\nexport const emailSchema = z.string().email('Invalid email format');\n\nexport const phoneSchema = z\n  .string()\n  .regex(/^[0-9]{9,10}$/, 'Phone must be 9-10 digits')\n  .optional();\n\n// ===========================================\n// Auth Schemas\n// ===========================================\n\n// Strong password validation result\nexport interface PasswordValidationResult {\n  valid: boolean;\n  errors: string[];\n  strength: 'weak' | 'fair' | 'good' | 'strong';\n}\n\n// Validate strong password with detailed feedback\nexport function validateStrongPassword(password: string): PasswordValidationResult {\n  const errors: string[] = [];\n\n  if (password.length < 12) {\n    errors.push('Password must be at least 12 characters long');\n  }\n\n  if (!/[A-Z]/.test(password)) {\n    errors.push('Password must contain at least one uppercase letter');\n  }\n\n  if (!/[a-z]/.test(password)) {\n    errors.push('Password must contain at least one lowercase letter');\n  }\n\n  if (!/[0-9]/.test(password)) {\n    errors.push('Password must contain at least one number');\n  }\n\n  if (!/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) {\n    errors.push('Password must contain at least one special character (!@#$%^&*...)');\n  }\n\n  // Check for common weak patterns\n  const weakPatterns = [\n    /^(.)\\1+$/, // All same character\n    /password/i,\n    /qwerty/i,\n    /123456/,\n    /admin/i,\n  ];\n\n  for (const pattern of weakPatterns) {\n    if (pattern.test(password)) {\n      errors.push('Password contains a common weak pattern');\n      break;\n    }\n  }\n\n  // Calculate strength\n  let strength: PasswordValidationResult['strength'] = 'weak';\n  if (errors.length === 0) {\n    const lengthScore = Math.min(password.length / 20, 1);\n    const varietyScore =\n      [/[A-Z]/.test(password), /[a-z]/.test(password), /[0-9]/.test(password), /[!@#$%^&*]/.test(password)].filter(\n        Boolean\n      ).length / 4;\n\n    const totalScore = (lengthScore + varietyScore) / 2;\n\n    if (totalScore >= 0.8) strength = 'strong';\n    else if (totalScore >= 0.6) strength = 'good';\n    else if (totalScore >= 0.4) strength = 'fair';\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n    strength,\n  };\n}\n\n// Strong password schema for production use\nexport const strongPasswordSchema = z\n  .string()\n  .min(12, 'Password must be at least 12 characters')\n  .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')\n  .regex(/[a-z]/, 'Password must contain at least one lowercase letter')\n  .regex(/[0-9]/, 'Password must contain at least one number')\n  .regex(/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/, 'Password must contain at least one special character');\n\nexport const registerSchema = z.object({\n  email: emailSchema,\n  name: z.string().min(2, 'Name must be at least 2 characters'),\n  phone: phoneSchema,\n  password: strongPasswordSchema,\n  role: z.enum(['CUSTOMER', 'VENDOR']).default('CUSTOMER'),\n});\n\nexport const loginSchema = z.object({\n  email: emailSchema,\n  password: z.string().min(1, 'Password is required'),\n});\n\nexport const updateProfileSchema = z.object({\n  name: z.string().min(2).optional(),\n  phone: phoneSchema,\n  avatar: z.string().url().optional(),\n});\n\n// Password reset request schema\nexport const passwordResetRequestSchema = z.object({\n  email: emailSchema,\n});\n\n// Password reset with token schema\nexport const passwordResetSchema = z\n  .object({\n    token: z.string().min(1, 'Reset token is required'),\n    password: strongPasswordSchema,\n    confirmPassword: z.string(),\n  })\n  .refine((data) => data.password === data.confirmPassword, {\n    message: 'Passwords do not match',\n    path: ['confirmPassword'],\n  });\n\n// Change password schema (for logged-in users)\nexport const changePasswordSchema = z\n  .object({\n    currentPassword: z.string().min(1, 'Current password is required'),\n    newPassword: strongPasswordSchema,\n    confirmPassword: z.string(),\n  })\n  .refine((data) => data.newPassword === data.confirmPassword, {\n    message: 'Passwords do not match',\n    path: ['confirmPassword'],\n  });\n\n// ===========================================\n// Vendor Schemas\n// ===========================================\n\nexport const createVendorSchema = z.object({\n  name: z.string().min(2, 'Vendor name must be at least 2 characters'),\n  description: z.string().optional(),\n  categories: z.array(z.string()).optional().default([]),\n});\n\nexport const updateVendorSchema = z.object({\n  name: z.string().min(2).optional(),\n  description: z.string().optional(),\n  image: z.string().url().optional(),\n  isOpen: z.boolean().optional(),\n  categories: z.array(z.string()).optional(),\n});\n\n// ===========================================\n// Menu Item Schemas\n// ===========================================\n\nexport const createMenuItemSchema = z.object({\n  name: z.string().min(2, 'Menu item name must be at least 2 characters'),\n  description: z.string().optional(),\n  price: z.number().positive('Price must be positive'),\n  category: z.string().min(1, 'Category is required'),\n  preparationTime: z.number().int().positive().optional().default(10),\n  isAvailable: z.boolean().optional().default(true),\n});\n\nexport const updateMenuItemSchema = z.object({\n  name: z.string().min(2).optional(),\n  description: z.string().optional(),\n  price: z.number().positive().optional(),\n  image: z.string().url().optional(),\n  category: z.string().optional(),\n  preparationTime: z.number().int().positive().optional(),\n  isAvailable: z.boolean().optional(),\n});\n\n// ===========================================\n// Reservation Schemas\n// ===========================================\n\nexport const reservationItemSchema = z.object({\n  menuItemId: z.string().min(1),\n  quantity: z.number().int().positive(),\n});\n\nexport const createReservationSchema = z.object({\n  vendorId: z.string().min(1, 'Vendor ID is required'),\n  timeSlotId: z.string().min(1, 'Time slot is required'),\n  customerName: z.string().min(2, 'Customer name is required'),\n  customerContact: z.string().min(1, 'Contact is required'),\n  paymentMethod: z.enum(['CASH', 'BANK_TRANSFER']),\n  items: z.array(reservationItemSchema).min(1, 'At least one item is required'),\n  notes: z.string().optional(),\n});\n\nexport const updateReservationStatusSchema = z.object({\n  status: z.enum([\n    'PENDING',\n    'CONFIRMED',\n    'PREPARING',\n    'READY',\n    'COMPLETED',\n    'CANCELLED',\n  ]),\n});\n\n// ===========================================\n// Time Slot Schemas\n// ===========================================\n\nexport const createTimeSlotSchema = z.object({\n  label: z.string().min(1),\n  startTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Invalid time format (HH:mm)'),\n  endTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Invalid time format (HH:mm)'),\n  period: z.enum(['MORNING', 'AFTERNOON']),\n  maxOrders: z.number().int().positive().optional().default(50),\n});\n\n// ===========================================\n// Review Schemas\n// ===========================================\n\nexport const createReviewSchema = z.object({\n  vendorId: z.string().min(1),\n  rating: z.number().int().min(1).max(5),\n  comment: z.string().optional(),\n  images: z.array(z.string().url()).optional().default([]),\n});\n\n// ===========================================\n// API Key Schemas\n// ===========================================\n\nexport const createApiKeySchema = z.object({\n  name: z.string().min(2, 'API key name must be at least 2 characters'),\n  permissions: z.array(z.string()).optional().default(['read']),\n  expiresAt: z.string().datetime().optional(),\n});\n\n// ===========================================\n// Admin Schemas\n// ===========================================\n\nexport const updateUserRoleSchema = z.object({\n  role: z.enum(['CUSTOMER', 'VENDOR', 'ADMIN']),\n});\n\nexport const createUserSchema = z.object({\n  email: emailSchema,\n  name: z.string().min(2),\n  phone: phoneSchema,\n  role: z.enum(['CUSTOMER', 'VENDOR', 'ADMIN']).default('CUSTOMER'),\n});\n\n// ===========================================\n// Type Exports\n// ===========================================\n\nexport type RegisterInput = z.infer<typeof registerSchema>;\nexport type LoginInput = z.infer<typeof loginSchema>;\nexport type UpdateProfileInput = z.infer<typeof updateProfileSchema>;\nexport type PasswordResetRequestInput = z.infer<typeof passwordResetRequestSchema>;\nexport type PasswordResetInput = z.infer<typeof passwordResetSchema>;\nexport type ChangePasswordInput = z.infer<typeof changePasswordSchema>;\nexport type CreateVendorInput = z.infer<typeof createVendorSchema>;\nexport type UpdateVendorInput = z.infer<typeof updateVendorSchema>;\nexport type CreateMenuItemInput = z.infer<typeof createMenuItemSchema>;\nexport type UpdateMenuItemInput = z.infer<typeof updateMenuItemSchema>;\nexport type CreateReservationInput = z.infer<typeof createReservationSchema>;\nexport type UpdateReservationStatusInput = z.infer<typeof updateReservationStatusSchema>;\nexport type CreateTimeSlotInput = z.infer<typeof createTimeSlotSchema>;\nexport type CreateReviewInput = z.infer<typeof createReviewSchema>;\nexport type CreateApiKeyInput = z.infer<typeof createApiKeySchema>;\nexport type PaginationInput = z.infer<typeof paginationSchema>;\n","// Authentication Controller\nimport { Elysia, t } from 'elysia';\nimport { Google } from 'arctic';\nimport * as authService from '../services/auth.service';\nimport { env } from '../config/env';\nimport { authPlugin, requireAuth, type AuthUser } from '../middlewares/auth.middleware';\nimport { success } from '../utils/response';\nimport {\n  registerSchema,\n  loginSchema,\n  passwordResetRequestSchema,\n  passwordResetSchema,\n  changePasswordSchema,\n  strongPasswordSchema,\n} from '../utils/validation';\nimport { BadRequestError } from '../utils/errors';\n\n// Type helpers\ntype AuthCtx = { user: AuthUser };\ntype OptionalAuthCtx = { user: AuthUser | undefined };\n\n// Google OAuth client\nconst google = new Google(\n  env.GOOGLE_CLIENT_ID,\n  env.GOOGLE_CLIENT_SECRET,\n  env.GOOGLE_CALLBACK_URL\n);\n\n// In-memory store for OAuth state and code verifiers (use Redis in production)\nconst oauthStore = new Map<string, { codeVerifier: string; expiresAt: number }>();\n\n// Cleanup expired entries periodically\nsetInterval(() => {\n  const now = Date.now();\n  for (const [key, value] of oauthStore.entries()) {\n    if (value.expiresAt < now) {\n      oauthStore.delete(key);\n    }\n  }\n}, 60000);\n\nexport const authController = new Elysia({ prefix: '/auth' })\n  // Health check\n  .get('/health', () => success({ status: 'ok' }))\n\n  // Register with email/password\n  .post(\n    '/register',\n    async ({ body }) => {\n      const validated = registerSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const session = await authService.register(validated.data);\n      return success(\n        {\n          user: session.user,\n          token: session.token,\n          expiresAt: session.expiresAt,\n        },\n        'Registration successful'\n      );\n    },\n    {\n      body: t.Object({\n        email: t.String(),\n        name: t.String(),\n        phone: t.Optional(t.String()),\n        password: t.String(),\n        role: t.Optional(t.Union([t.Literal('CUSTOMER'), t.Literal('VENDOR')])),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Register new user',\n        description: 'Register a new user with email and password',\n      },\n    }\n  )\n\n  // Login with email/password\n  .post(\n    '/login',\n    async ({ body }) => {\n      const validated = loginSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const session = await authService.login(validated.data);\n      return success(\n        {\n          user: session.user,\n          token: session.token,\n          expiresAt: session.expiresAt,\n        },\n        'Login successful'\n      );\n    },\n    {\n      body: t.Object({\n        email: t.String(),\n        password: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Login',\n        description: 'Login with email and password',\n      },\n    }\n  )\n\n  // Google OAuth - Start\n  .get(\n    '/google',\n    async ({ redirect }) => {\n      const state = crypto.randomUUID();\n      const codeVerifier = crypto.randomUUID() + crypto.randomUUID(); // Longer verifier for security\n      const scopes = ['openid', 'profile', 'email'];\n      const url = await google.createAuthorizationURL(state, codeVerifier, { scopes });\n\n      // Store the code verifier with state (expires in 10 minutes)\n      oauthStore.set(state, {\n        codeVerifier,\n        expiresAt: Date.now() + 10 * 60 * 1000,\n      });\n\n      // Add access_type=offline for refresh token\n      url.searchParams.set('access_type', 'offline');\n      url.searchParams.set('prompt', 'consent');\n\n      return redirect(url.toString());\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Google OAuth',\n        description: 'Start Google OAuth flow',\n      },\n    }\n  )\n\n  // Google OAuth - Callback\n  .get(\n    '/google/callback',\n    async ({ query, redirect }) => {\n      const { code, state, error } = query;\n\n      if (error || !code) {\n        return redirect(`${env.FRONTEND_URL}/login?error=oauth_failed`);\n      }\n\n      try {\n        // Get the stored code verifier using the state\n        const storedData = state ? oauthStore.get(state) : null;\n        if (!storedData) {\n          console.error('OAuth state not found or expired');\n          return redirect(`${env.FRONTEND_URL}/login?error=oauth_expired`);\n        }\n\n        // Delete the stored data (one-time use)\n        oauthStore.delete(state!);\n\n        // Exchange code for tokens with the stored code verifier\n        const tokens = await google.validateAuthorizationCode(code, storedData.codeVerifier);\n\n        // Get user info from Google\n        const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {\n          headers: {\n            Authorization: `Bearer ${tokens.accessToken}`,\n          },\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch user info');\n        }\n\n        const googleUser = (await response.json()) as {\n          sub: string;\n          email: string;\n          name: string;\n          picture?: string;\n        };\n\n        // Login or register with Google\n        const session = await authService.googleAuth(\n          {\n            id: googleUser.sub,\n            email: googleUser.email,\n            name: googleUser.name,\n            picture: googleUser.picture,\n          },\n          {\n            accessToken: tokens.accessToken,\n            refreshToken: tokens.refreshToken ?? undefined,\n            expiresAt: tokens.accessTokenExpiresAt\n              ? Math.floor(tokens.accessTokenExpiresAt.getTime() / 1000)\n              : undefined,\n          }\n        );\n\n        console.log('Google OAuth session created:', {\n          userId: session.user.id,\n          email: session.user.email,\n          tokenPrefix: session.token.substring(0, 10) + '...',\n          expiresAt: session.expiresAt,\n        });\n\n        // Redirect to frontend with token\n        const redirectUrl = new URL(`${env.FRONTEND_URL}/auth/callback`);\n        redirectUrl.searchParams.set('token', session.token);\n        redirectUrl.searchParams.set('expires', session.expiresAt.toISOString());\n\n        return redirect(redirectUrl.toString());\n      } catch (err) {\n        console.error('Google OAuth error:', err);\n        return redirect(`${env.FRONTEND_URL}/login?error=oauth_failed`);\n      }\n    },\n    {\n      query: t.Object({\n        code: t.Optional(t.String()),\n        state: t.Optional(t.String()),\n        error: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Google OAuth Callback',\n        description: 'Handle Google OAuth callback',\n      },\n    }\n  )\n\n  // Get current user\n  .use(authPlugin)\n  .get(\n    '/me',\n    async (ctx) => {\n      let { user, bearer } = ctx as unknown as OptionalAuthCtx & { bearer?: string };\n      console.log('/auth/me called:', {\n        hasBearer: !!bearer,\n        bearerPrefix: bearer ? bearer.substring(0, 10) + '...' : null,\n        hasUser: !!user,\n        userId: user?.id,\n      });\n\n      // If authPlugin didn't set user but we have bearer, try validating directly\n      if (!user && bearer) {\n        console.log('Attempting direct session validation...');\n        const validatedUser = await authService.validateSession(bearer);\n        console.log('Direct validation result:', { hasUser: !!validatedUser });\n        if (validatedUser) {\n          return success(validatedUser);\n        }\n      }\n\n      if (!user) {\n        // Return debug info for troubleshooting\n        return {\n          success: true,\n          data: null,\n          message: 'Not authenticated',\n          debug: {\n            hasBearer: !!bearer,\n            bearerPrefix: bearer ? bearer.substring(0, 10) + '...' : null,\n          },\n        };\n      }\n      return success(user);\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Get current user',\n        description: 'Get currently authenticated user',\n      },\n    }\n  )\n\n  // Logout\n  .use(requireAuth)\n  .post(\n    '/logout',\n    async (ctx) => {\n      const { bearer } = ctx as unknown as { bearer: string };\n      if (bearer) {\n        await authService.logout(bearer);\n      }\n      return success(null, 'Logged out successfully');\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Logout',\n        description: 'Logout current session',\n      },\n    }\n  )\n\n  // Logout all sessions\n  .post(\n    '/logout-all',\n    async (ctx) => {\n      const { user } = ctx as unknown as AuthCtx;\n      await authService.logoutAll(user.id);\n      return success(null, 'All sessions logged out');\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Logout all',\n        description: 'Logout all sessions for current user',\n      },\n    }\n  )\n\n  // Get user sessions\n  .get(\n    '/sessions',\n    async (ctx) => {\n      const { user } = ctx as unknown as AuthCtx;\n      const sessions = await authService.getUserSessions(user.id);\n      return success(sessions);\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Get sessions',\n        description: 'Get all active sessions for current user',\n      },\n    }\n  )\n\n  // Delete specific session\n  .delete(\n    '/sessions/:sessionId',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { sessionId: string } };\n      await authService.deleteSession(user.id, params.sessionId);\n      return success(null, 'Session deleted');\n    },\n    {\n      params: t.Object({\n        sessionId: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Delete session',\n        description: 'Delete a specific session',\n      },\n    }\n  )\n\n  // Change password (requires auth)\n  .post(\n    '/change-password',\n    async ({ body, ...ctx }) => {\n      const { user } = ctx as unknown as AuthCtx;\n      const validated = changePasswordSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      await authService.changePassword(user.id, validated.data.currentPassword, validated.data.newPassword);\n      return success(null, 'Password changed successfully');\n    },\n    {\n      body: t.Object({\n        currentPassword: t.String(),\n        newPassword: t.String(),\n        confirmPassword: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Change password',\n        description: 'Change password for authenticated user',\n      },\n    }\n  )\n\n  // Resend verification email (requires auth)\n  .post(\n    '/resend-verification',\n    async (ctx) => {\n      const { user } = ctx as unknown as AuthCtx;\n      await authService.resendVerificationEmail(user.id);\n      return success(null, 'Verification email sent');\n    },\n    {\n      detail: {\n        tags: ['Auth'],\n        summary: 'Resend verification email',\n        description: 'Resend email verification link',\n      },\n    }\n  );\n\n// Public password reset routes (no auth required)\nexport const passwordResetController = new Elysia({ prefix: '/auth' })\n  // Request password reset\n  .post(\n    '/forgot-password',\n    async ({ body }) => {\n      const validated = passwordResetRequestSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      await authService.requestPasswordReset(validated.data.email);\n      // Always return success to prevent email enumeration\n      return success(null, 'If an account exists with this email, a password reset link has been sent.');\n    },\n    {\n      body: t.Object({\n        email: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Request password reset',\n        description: 'Request a password reset email',\n      },\n    }\n  )\n\n  // Reset password with token\n  .post(\n    '/reset-password',\n    async ({ body }) => {\n      const validated = passwordResetSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      // Validate password strength\n      const passwordValidation = strongPasswordSchema.safeParse(validated.data.password);\n      if (!passwordValidation.success) {\n        throw new BadRequestError(passwordValidation.error.errors[0].message);\n      }\n\n      await authService.resetPassword(validated.data.token, validated.data.password);\n      return success(null, 'Password has been reset successfully. Please login with your new password.');\n    },\n    {\n      body: t.Object({\n        token: t.String(),\n        password: t.String(),\n        confirmPassword: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Reset password',\n        description: 'Reset password using reset token',\n      },\n    }\n  )\n\n  // Verify email with token\n  .post(\n    '/verify-email',\n    async ({ body }) => {\n      await authService.verifyEmail(body.token);\n      return success(null, 'Email verified successfully');\n    },\n    {\n      body: t.Object({\n        token: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Verify email',\n        description: 'Verify email address with token',\n      },\n    }\n  )\n\n  // Test email (for development/testing)\n  .post(\n    '/test-email',\n    async ({ body }) => {\n      const { sendTestEmail } = await import('../services/email.service');\n      const result = await sendTestEmail(body.email);\n      return result.success ? success(result, result.message) : { success: false, error: result.message };\n    },\n    {\n      body: t.Object({\n        email: t.String(),\n      }),\n      detail: {\n        tags: ['Auth'],\n        summary: 'Test email',\n        description: 'Send a test email to verify SMTP configuration',\n      },\n    }\n  );\n","// User Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ConflictError } from '../utils/errors';\nimport { parsePagination, createPaginationMeta } from '../utils/response';\nimport type { UpdateProfileInput, PaginationInput } from '../utils/validation';\nimport type { Role } from '@prisma/client';\n\nexport interface UserResponse {\n  id: string;\n  email: string;\n  name: string;\n  phone: string | null;\n  avatar: string | null;\n  role: Role;\n  isActive: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Get user by ID\n */\nexport async function getUserById(userId: string): Promise<UserResponse> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      isActive: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  return user;\n}\n\n/**\n * Update user profile\n */\nexport async function updateProfile(\n  userId: string,\n  input: UpdateProfileInput\n): Promise<UserResponse> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  const updated = await prisma.user.update({\n    where: { id: userId },\n    data: {\n      name: input.name,\n      phone: input.phone,\n      avatar: input.avatar,\n    },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      isActive: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Get all users (admin only)\n */\nexport async function getAllUsers(\n  pagination: PaginationInput,\n  filters?: {\n    role?: Role;\n    search?: string;\n    isActive?: boolean;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = {};\n\n  if (filters?.role) {\n    where.role = filters.role;\n  }\n\n  if (filters?.isActive !== undefined) {\n    where.isActive = filters.isActive;\n  }\n\n  if (filters?.search) {\n    where.OR = [\n      { name: { contains: filters.search, mode: 'insensitive' } },\n      { email: { contains: filters.search, mode: 'insensitive' } },\n    ];\n  }\n\n  const [users, total] = await Promise.all([\n    prisma.user.findMany({\n      where,\n      select: {\n        id: true,\n        email: true,\n        name: true,\n        phone: true,\n        avatar: true,\n        role: true,\n        isActive: true,\n        createdAt: true,\n        updatedAt: true,\n      },\n      orderBy: { createdAt: 'desc' },\n      skip,\n      take: limit,\n    }),\n    prisma.user.count({ where }),\n  ]);\n\n  return {\n    items: users,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Update user role (admin only)\n */\nexport async function updateUserRole(\n  userId: string,\n  role: Role\n): Promise<UserResponse> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  const updated = await prisma.user.update({\n    where: { id: userId },\n    data: { role },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      isActive: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Toggle user active status (admin only)\n */\nexport async function toggleUserStatus(userId: string): Promise<UserResponse> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  const updated = await prisma.user.update({\n    where: { id: userId },\n    data: { isActive: !user.isActive },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      isActive: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Delete user (admin only)\n */\nexport async function deleteUser(userId: string): Promise<void> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  await prisma.user.delete({\n    where: { id: userId },\n  });\n}\n\n/**\n * Update user password (admin only)\n */\nexport async function updateUserPassword(\n  userId: string,\n  newPassword: string\n): Promise<UserResponse> {\n  const user = await prisma.user.findUnique({\n    where: { id: userId },\n  });\n\n  if (!user) {\n    throw new NotFoundError('User');\n  }\n\n  // Hash the new password\n  const hashedPassword = await Bun.password.hash(newPassword, {\n    algorithm: 'bcrypt',\n    cost: 10,\n  });\n\n  const updated = await prisma.user.update({\n    where: { id: userId },\n    data: { password: hashedPassword },\n    select: {\n      id: true,\n      email: true,\n      name: true,\n      phone: true,\n      avatar: true,\n      role: true,\n      isActive: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Get user statistics\n */\nexport async function getUserStats() {\n  const [total, customers, vendors, admins, active, inactive] =\n    await Promise.all([\n      prisma.user.count(),\n      prisma.user.count({ where: { role: 'CUSTOMER' } }),\n      prisma.user.count({ where: { role: 'VENDOR' } }),\n      prisma.user.count({ where: { role: 'ADMIN' } }),\n      prisma.user.count({ where: { isActive: true } }),\n      prisma.user.count({ where: { isActive: false } }),\n    ]);\n\n  return {\n    total,\n    byRole: { customers, vendors, admins },\n    byStatus: { active, inactive },\n  };\n}\n","// User Controller\nimport { Elysia, t } from 'elysia';\nimport { bearer } from '@elysiajs/bearer';\nimport * as userService from '../services/user.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport { success, paginated } from '../utils/response';\nimport { updateProfileSchema, paginationSchema } from '../utils/validation';\nimport { BadRequestError, UnauthorizedError, ForbiddenError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\n// Helper function to require admin role\nasync function getAdminUser(request: Request): Promise<AuthUser> {\n  const user = await getAuthUser(request);\n  if (user.role !== 'ADMIN') {\n    throw new ForbiddenError('Admin access required');\n  }\n  return user;\n}\n\nexport const userController = new Elysia({ prefix: '/users' })\n  .use(bearer())\n\n  // Get current user profile\n  .get(\n    '/me',\n    async ({ request }) => {\n      const user = await getAuthUser(request);\n      const profile = await userService.getUserById(user.id);\n      return success(profile);\n    },\n    {\n      detail: {\n        tags: ['Users'],\n        summary: 'Get my profile',\n        description: 'Get current user profile',\n      },\n    }\n  )\n\n  // Update current user profile\n  .patch(\n    '/me',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n      const validated = updateProfileSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const profile = await userService.updateProfile(user.id, validated.data);\n      return success(profile, 'Profile updated');\n    },\n    {\n      body: t.Object({\n        name: t.Optional(t.String()),\n        phone: t.Optional(t.String()),\n        avatar: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Update my profile',\n        description: 'Update current user profile',\n      },\n    }\n  )\n\n  // Get user stats (admin) - must be before /:userId to avoid route conflict\n  .get(\n    '/stats/overview',\n    async ({ request }) => {\n      await getAdminUser(request);\n      const stats = await userService.getUserStats();\n      return success(stats);\n    },\n    {\n      detail: {\n        tags: ['Users'],\n        summary: 'Get user statistics',\n        description: 'Get user statistics (admin only)',\n      },\n    }\n  )\n\n  // Get all users (admin)\n  .get(\n    '/',\n    async ({ request, query }) => {\n      await getAdminUser(request);\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n      const result = await userService.getAllUsers(\n        paginationData,\n        {\n          role: query.role as any,\n          search: query.search,\n          isActive: query.isActive === 'true' ? true : query.isActive === 'false' ? false : undefined,\n        }\n      );\n      return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        role: t.Optional(t.String()),\n        search: t.Optional(t.String()),\n        isActive: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'List all users',\n        description: 'Get all users (admin only)',\n      },\n    }\n  )\n\n  // Get user by ID (admin)\n  .get(\n    '/:userId',\n    async ({ request, params }) => {\n      await getAdminUser(request);\n      const user = await userService.getUserById(params.userId);\n      return success(user);\n    },\n    {\n      params: t.Object({\n        userId: t.String(),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Get user by ID',\n        description: 'Get user details by ID (admin only)',\n      },\n    }\n  )\n\n  // Update user role (admin)\n  .patch(\n    '/:userId/role',\n    async ({ request, params, body }) => {\n      await getAdminUser(request);\n      const user = await userService.updateUserRole(params.userId, body.role as any);\n      return success(user, 'Role updated');\n    },\n    {\n      params: t.Object({\n        userId: t.String(),\n      }),\n      body: t.Object({\n        role: t.Union([\n          t.Literal('CUSTOMER'),\n          t.Literal('VENDOR'),\n          t.Literal('ADMIN'),\n        ]),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Update user role',\n        description: 'Update user role (admin only)',\n      },\n    }\n  )\n\n  // Toggle user status (admin)\n  .patch(\n    '/:userId/toggle-status',\n    async ({ request, params }) => {\n      await getAdminUser(request);\n      const user = await userService.toggleUserStatus(params.userId);\n      return success(user, `User ${user.isActive ? 'activated' : 'deactivated'}`);\n    },\n    {\n      params: t.Object({\n        userId: t.String(),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Toggle user status',\n        description: 'Activate/deactivate user (admin only)',\n      },\n    }\n  )\n\n  // Update user password (admin)\n  .patch(\n    '/:userId/password',\n    async ({ request, params, body }) => {\n      await getAdminUser(request);\n      if (!body.password || body.password.length < 6) {\n        throw new BadRequestError('Password must be at least 6 characters');\n      }\n      const user = await userService.updateUserPassword(params.userId, body.password);\n      return success(user, 'Password updated');\n    },\n    {\n      params: t.Object({\n        userId: t.String(),\n      }),\n      body: t.Object({\n        password: t.String(),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Update user password',\n        description: 'Update user password (admin only)',\n      },\n    }\n  )\n\n  // Delete user (admin)\n  .delete(\n    '/:userId',\n    async ({ request, params }) => {\n      await getAdminUser(request);\n      await userService.deleteUser(params.userId);\n      return success(null, 'User deleted');\n    },\n    {\n      params: t.Object({\n        userId: t.String(),\n      }),\n      detail: {\n        tags: ['Users'],\n        summary: 'Delete user',\n        description: 'Delete user (admin only)',\n      },\n    }\n  );\n","// API Key Service\nimport { prisma } from '../config/database';\nimport { generateApiKey } from '../utils/crypto';\nimport { NotFoundError, BadRequestError } from '../utils/errors';\nimport type { CreateApiKeyInput } from '../utils/validation';\n\nexport interface ApiKeyResponse {\n  id: string;\n  name: string;\n  keyPrefix: string;\n  permissions: string[];\n  status: string;\n  lastUsedAt: Date | null;\n  expiresAt: Date | null;\n  createdAt: Date;\n}\n\n/**\n * Create a new API key for a user\n */\nexport async function createApiKey(\n  userId: string,\n  input: CreateApiKeyInput\n): Promise<{ apiKey: ApiKeyResponse; key: string }> {\n  const { key, prefix } = generateApiKey();\n\n  const apiKey = await prisma.aPIKey.create({\n    data: {\n      userId,\n      name: input.name,\n      key,\n      keyPrefix: prefix,\n      permissions: input.permissions,\n      expiresAt: input.expiresAt ? new Date(input.expiresAt) : null,\n    },\n  });\n\n  return {\n    apiKey: {\n      id: apiKey.id,\n      name: apiKey.name,\n      keyPrefix: apiKey.keyPrefix,\n      permissions: apiKey.permissions,\n      status: apiKey.status,\n      lastUsedAt: apiKey.lastUsedAt,\n      expiresAt: apiKey.expiresAt,\n      createdAt: apiKey.createdAt,\n    },\n    key, // Only returned once when created\n  };\n}\n\n/**\n * Get all API keys for a user\n */\nexport async function getUserApiKeys(userId: string): Promise<ApiKeyResponse[]> {\n  const apiKeys = await prisma.aPIKey.findMany({\n    where: { userId },\n    select: {\n      id: true,\n      name: true,\n      keyPrefix: true,\n      permissions: true,\n      status: true,\n      lastUsedAt: true,\n      expiresAt: true,\n      createdAt: true,\n    },\n    orderBy: { createdAt: 'desc' },\n  });\n\n  return apiKeys;\n}\n\n/**\n * Get single API key\n */\nexport async function getApiKey(\n  userId: string,\n  keyId: string\n): Promise<ApiKeyResponse> {\n  const apiKey = await prisma.aPIKey.findFirst({\n    where: { id: keyId, userId },\n    select: {\n      id: true,\n      name: true,\n      keyPrefix: true,\n      permissions: true,\n      status: true,\n      lastUsedAt: true,\n      expiresAt: true,\n      createdAt: true,\n    },\n  });\n\n  if (!apiKey) {\n    throw new NotFoundError('API Key');\n  }\n\n  return apiKey;\n}\n\n/**\n * Update API key permissions\n */\nexport async function updateApiKeyPermissions(\n  userId: string,\n  keyId: string,\n  permissions: string[]\n): Promise<ApiKeyResponse> {\n  const apiKey = await prisma.aPIKey.findFirst({\n    where: { id: keyId, userId },\n  });\n\n  if (!apiKey) {\n    throw new NotFoundError('API Key');\n  }\n\n  const updated = await prisma.aPIKey.update({\n    where: { id: keyId },\n    data: { permissions },\n    select: {\n      id: true,\n      name: true,\n      keyPrefix: true,\n      permissions: true,\n      status: true,\n      lastUsedAt: true,\n      expiresAt: true,\n      createdAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Revoke an API key\n */\nexport async function revokeApiKey(\n  userId: string,\n  keyId: string\n): Promise<ApiKeyResponse> {\n  const apiKey = await prisma.aPIKey.findFirst({\n    where: { id: keyId, userId },\n  });\n\n  if (!apiKey) {\n    throw new NotFoundError('API Key');\n  }\n\n  if (apiKey.status === 'REVOKED') {\n    throw new BadRequestError('API Key is already revoked');\n  }\n\n  const updated = await prisma.aPIKey.update({\n    where: { id: keyId },\n    data: { status: 'REVOKED' },\n    select: {\n      id: true,\n      name: true,\n      keyPrefix: true,\n      permissions: true,\n      status: true,\n      lastUsedAt: true,\n      expiresAt: true,\n      createdAt: true,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Rotate an API key (revoke old and create new)\n */\nexport async function rotateApiKey(\n  userId: string,\n  keyId: string\n): Promise<{ apiKey: ApiKeyResponse; key: string }> {\n  const oldKey = await prisma.aPIKey.findFirst({\n    where: { id: keyId, userId },\n  });\n\n  if (!oldKey) {\n    throw new NotFoundError('API Key');\n  }\n\n  // Generate new key\n  const { key, prefix } = generateApiKey();\n\n  // Use transaction to revoke old and create new\n  const [_, newApiKey] = await prisma.$transaction([\n    prisma.aPIKey.update({\n      where: { id: keyId },\n      data: { status: 'REVOKED' },\n    }),\n    prisma.aPIKey.create({\n      data: {\n        userId,\n        name: oldKey.name,\n        key,\n        keyPrefix: prefix,\n        permissions: oldKey.permissions,\n        expiresAt: oldKey.expiresAt,\n      },\n    }),\n  ]);\n\n  return {\n    apiKey: {\n      id: newApiKey.id,\n      name: newApiKey.name,\n      keyPrefix: newApiKey.keyPrefix,\n      permissions: newApiKey.permissions,\n      status: newApiKey.status,\n      lastUsedAt: newApiKey.lastUsedAt,\n      expiresAt: newApiKey.expiresAt,\n      createdAt: newApiKey.createdAt,\n    },\n    key,\n  };\n}\n\n/**\n * Delete an API key permanently\n */\nexport async function deleteApiKey(\n  userId: string,\n  keyId: string\n): Promise<void> {\n  const apiKey = await prisma.aPIKey.findFirst({\n    where: { id: keyId, userId },\n  });\n\n  if (!apiKey) {\n    throw new NotFoundError('API Key');\n  }\n\n  await prisma.aPIKey.delete({\n    where: { id: keyId },\n  });\n}\n\n/**\n * Validate API key and return user info\n */\nexport async function validateApiKey(key: string) {\n  const apiKey = await prisma.aPIKey.findFirst({\n    where: {\n      key,\n      status: 'ACTIVE',\n      OR: [{ expiresAt: null }, { expiresAt: { gt: new Date() } }],\n    },\n    include: { user: true },\n  });\n\n  if (!apiKey) {\n    return null;\n  }\n\n  // Update last used\n  await prisma.aPIKey.update({\n    where: { id: apiKey.id },\n    data: { lastUsedAt: new Date() },\n  });\n\n  return {\n    apiKey: {\n      id: apiKey.id,\n      name: apiKey.name,\n      permissions: apiKey.permissions,\n    },\n    user: {\n      id: apiKey.user.id,\n      email: apiKey.user.email,\n      name: apiKey.user.name,\n      role: apiKey.user.role,\n    },\n  };\n}\n","// API Key Controller\nimport { Elysia, t } from 'elysia';\nimport * as apiKeyService from '../services/apikey.service';\nimport { requireAuth, type AuthUser } from '../middlewares/auth.middleware';\nimport { success } from '../utils/response';\nimport { createApiKeySchema } from '../utils/validation';\nimport { BadRequestError } from '../utils/errors';\n\n// Type helper for authenticated context\ntype AuthCtx = { user: AuthUser };\n\nexport const apiKeyController = new Elysia({ prefix: '/api-keys' })\n  .use(requireAuth)\n\n  // List user's API keys\n  .get(\n    '/',\n    async (ctx) => {\n      const { user } = ctx as unknown as AuthCtx;\n      const apiKeys = await apiKeyService.getUserApiKeys(user.id);\n      return success(apiKeys);\n    },\n    {\n      detail: {\n        tags: ['API Keys'],\n        summary: 'List API keys',\n        description: 'Get all API keys for current user',\n      },\n    }\n  )\n\n  // Create new API key\n  .post(\n    '/',\n    async (ctx) => {\n      const { user, body } = ctx as unknown as AuthCtx & { body: any };\n      const validated = createApiKeySchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const result = await apiKeyService.createApiKey(user.id, validated.data);\n      return success(\n        result,\n        'API key created. Save the key now - it will not be shown again.'\n      );\n    },\n    {\n      body: t.Object({\n        name: t.String(),\n        permissions: t.Optional(t.Array(t.String())),\n        expiresAt: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Create API key',\n        description: 'Create a new API key',\n      },\n    }\n  )\n\n  // Get single API key\n  .get(\n    '/:keyId',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { keyId: string } };\n      const apiKey = await apiKeyService.getApiKey(user.id, params.keyId);\n      return success(apiKey);\n    },\n    {\n      params: t.Object({\n        keyId: t.String(),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Get API key',\n        description: 'Get details of a specific API key',\n      },\n    }\n  )\n\n  // Update API key permissions\n  .patch(\n    '/:keyId/permissions',\n    async (ctx) => {\n      const { user, params, body } = ctx as unknown as AuthCtx & { params: { keyId: string }; body: { permissions: string[] } };\n      const apiKey = await apiKeyService.updateApiKeyPermissions(\n        user.id,\n        params.keyId,\n        body.permissions\n      );\n      return success(apiKey, 'Permissions updated');\n    },\n    {\n      params: t.Object({\n        keyId: t.String(),\n      }),\n      body: t.Object({\n        permissions: t.Array(t.String()),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Update permissions',\n        description: 'Update API key permissions',\n      },\n    }\n  )\n\n  // Revoke API key\n  .post(\n    '/:keyId/revoke',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { keyId: string } };\n      const apiKey = await apiKeyService.revokeApiKey(user.id, params.keyId);\n      return success(apiKey, 'API key revoked');\n    },\n    {\n      params: t.Object({\n        keyId: t.String(),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Revoke API key',\n        description: 'Revoke an API key (cannot be undone)',\n      },\n    }\n  )\n\n  // Rotate API key\n  .post(\n    '/:keyId/rotate',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { keyId: string } };\n      const result = await apiKeyService.rotateApiKey(user.id, params.keyId);\n      return success(\n        result,\n        'API key rotated. Save the new key now - it will not be shown again.'\n      );\n    },\n    {\n      params: t.Object({\n        keyId: t.String(),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Rotate API key',\n        description: 'Revoke old key and generate a new one with same permissions',\n      },\n    }\n  )\n\n  // Delete API key\n  .delete(\n    '/:keyId',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { keyId: string } };\n      await apiKeyService.deleteApiKey(user.id, params.keyId);\n      return success(null, 'API key deleted');\n    },\n    {\n      params: t.Object({\n        keyId: t.String(),\n      }),\n      detail: {\n        tags: ['API Keys'],\n        summary: 'Delete API key',\n        description: 'Permanently delete an API key',\n      },\n    }\n  );\n","// Vendor Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ForbiddenError, ConflictError } from '../utils/errors';\nimport { parsePagination, createPaginationMeta } from '../utils/response';\nimport type {\n  CreateVendorInput,\n  UpdateVendorInput,\n  PaginationInput,\n} from '../utils/validation';\nimport type { Role } from '@prisma/client';\n\nexport interface VendorResponse {\n  id: string;\n  userId: string;\n  name: string;\n  description: string | null;\n  image: string | null;\n  rating: number;\n  totalOrders: number;\n  isOpen: boolean;\n  categories: string[];\n  createdAt: Date;\n  updatedAt: Date;\n  user?: {\n    id: string;\n    email: string;\n    name: string;\n    avatar: string | null;\n  };\n}\n\n/**\n * Create vendor for a user\n */\nexport async function createVendor(\n  userId: string,\n  input: CreateVendorInput\n): Promise<VendorResponse> {\n  // Check if user already has a vendor\n  const existingVendor = await prisma.vendor.findUnique({\n    where: { userId },\n  });\n\n  if (existingVendor) {\n    throw new ConflictError('User already has a vendor profile');\n  }\n\n  // Create vendor and update user role\n  const [vendor] = await prisma.$transaction([\n    prisma.vendor.create({\n      data: {\n        userId,\n        name: input.name,\n        description: input.description,\n        categories: input.categories,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            email: true,\n            name: true,\n            avatar: true,\n          },\n        },\n      },\n    }),\n    prisma.user.update({\n      where: { id: userId },\n      data: { role: 'VENDOR' },\n    }),\n  ]);\n\n  return vendor;\n}\n\n/**\n * Get vendor by ID\n */\nexport async function getVendorById(vendorId: string): Promise<VendorResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n          avatar: true,\n        },\n      },\n    },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  return vendor;\n}\n\n/**\n * Get vendor by user ID\n */\nexport async function getVendorByUserId(userId: string): Promise<VendorResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { userId },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n          avatar: true,\n        },\n      },\n    },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  return vendor;\n}\n\n/**\n * Update vendor\n */\nexport async function updateVendor(\n  vendorId: string,\n  userId: string,\n  userRole: Role,\n  input: UpdateVendorInput\n): Promise<VendorResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  // Check permission - vendor owner or admin\n  if (vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this vendor');\n  }\n\n  const updated = await prisma.vendor.update({\n    where: { id: vendorId },\n    data: {\n      name: input.name,\n      description: input.description,\n      image: input.image,\n      isOpen: input.isOpen,\n      categories: input.categories,\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n          avatar: true,\n        },\n      },\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Get all vendors with pagination and filters\n */\nexport async function getAllVendors(\n  pagination: PaginationInput,\n  filters?: {\n    isOpen?: boolean;\n    category?: string;\n    search?: string;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = {};\n\n  if (filters?.isOpen !== undefined) {\n    where.isOpen = filters.isOpen;\n  }\n\n  if (filters?.category) {\n    where.categories = { has: filters.category };\n  }\n\n  if (filters?.search) {\n    where.OR = [\n      { name: { contains: filters.search, mode: 'insensitive' } },\n      { description: { contains: filters.search, mode: 'insensitive' } },\n    ];\n  }\n\n  const [vendors, total] = await Promise.all([\n    prisma.vendor.findMany({\n      where,\n      include: {\n        user: {\n          select: {\n            id: true,\n            email: true,\n            name: true,\n            avatar: true,\n          },\n        },\n      },\n      orderBy: [{ rating: 'desc' }, { totalOrders: 'desc' }],\n      skip,\n      take: limit,\n    }),\n    prisma.vendor.count({ where }),\n  ]);\n\n  return {\n    items: vendors,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Toggle vendor open/close status\n */\nexport async function toggleVendorStatus(\n  vendorId: string,\n  userId: string,\n  userRole: Role\n): Promise<VendorResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  if (vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this vendor');\n  }\n\n  const updated = await prisma.vendor.update({\n    where: { id: vendorId },\n    data: { isOpen: !vendor.isOpen },\n    include: {\n      user: {\n        select: {\n          id: true,\n          email: true,\n          name: true,\n          avatar: true,\n        },\n      },\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Delete vendor (admin only)\n */\nexport async function deleteVendor(vendorId: string): Promise<void> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  await prisma.$transaction([\n    prisma.vendor.delete({ where: { id: vendorId } }),\n    prisma.user.update({\n      where: { id: vendor.userId },\n      data: { role: 'CUSTOMER' },\n    }),\n  ]);\n}\n\n/**\n * Get vendor statistics\n */\nexport async function getVendorStats(vendorId: string) {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n    include: {\n      _count: {\n        select: {\n          menuItems: true,\n          reservations: true,\n          reviews: true,\n        },\n      },\n      reservations: {\n        where: {\n          createdAt: {\n            gte: new Date(new Date().setHours(0, 0, 0, 0)),\n          },\n        },\n        select: { status: true, totalAmount: true },\n      },\n    },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  const todayReservations = vendor.reservations;\n  const todayRevenue = todayReservations\n    .filter((r) => r.status === 'COMPLETED')\n    .reduce((sum, r) => sum + r.totalAmount, 0);\n\n  return {\n    menuItemsCount: vendor._count.menuItems,\n    totalReservations: vendor._count.reservations,\n    reviewsCount: vendor._count.reviews,\n    rating: vendor.rating,\n    totalOrders: vendor.totalOrders,\n    today: {\n      reservations: todayReservations.length,\n      revenue: todayRevenue,\n      pending: todayReservations.filter((r) => r.status === 'PENDING').length,\n      preparing: todayReservations.filter((r) => r.status === 'PREPARING').length,\n      completed: todayReservations.filter((r) => r.status === 'COMPLETED').length,\n    },\n  };\n}\n\n/**\n * Get all categories from all vendors\n */\nexport async function getAllCategories(): Promise<string[]> {\n  const vendors = await prisma.vendor.findMany({\n    select: { categories: true },\n  });\n\n  const allCategories = vendors.flatMap((v) => v.categories);\n  return [...new Set(allCategories)].sort();\n}\n","// Vendor Controller\nimport { Elysia, t } from 'elysia';\nimport * as vendorService from '../services/vendor.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport {\n  authPlugin,\n  requireAuth,\n  requireVendorOrAdmin,\n  requireAdmin,\n} from '../middlewares/auth.middleware';\nimport { success, paginated } from '../utils/response';\nimport {\n  createVendorSchema,\n  updateVendorSchema,\n  paginationSchema,\n} from '../utils/validation';\nimport { BadRequestError, UnauthorizedError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\nexport const vendorController = new Elysia({ prefix: '/vendors' })\n  // Public routes\n  .use(authPlugin)\n\n  // Get all vendors (public)\n  .get(\n    '/',\n    async ({ query }) => {\n    const paginationResult = paginationSchema.safeParse(query);\n\n    const pagination = paginationResult.success\n      ? paginationResult.data\n      : { page: 1, limit: 10 };\n\n    const result = await vendorService.getAllVendors(pagination, {\n      isOpen:\n        query.isOpen === \"true\"\n          ? true\n          : query.isOpen === \"false\"\n          ? false\n          : undefined,\n      category: query.category,\n      search: query.search,\n    });\n\n    return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        isOpen: t.Optional(t.String()),\n        category: t.Optional(t.String()),\n        search: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'List all vendors',\n        description: 'Get all vendors with optional filters',\n      },\n    }\n  )\n\n  // Get all categories\n  .get(\n    '/categories',\n    async () => {\n      const categories = await vendorService.getAllCategories();\n      return success(categories);\n    },\n    {\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Get all categories',\n        description: 'Get list of all vendor categories',\n      },\n    }\n  )\n\n  // Get vendor by ID (public)\n  .get(\n    '/:vendorId',\n    async ({ params }) => {\n      const vendor = await vendorService.getVendorById(params.vendorId);\n      return success(vendor);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Get vendor by ID',\n        description: 'Get vendor details',\n      },\n    }\n  )\n\n  // Protected routes\n  .use(requireAuth)\n\n  // Get my vendor profile\n  .get(\n    '/me/profile',\n    async ({ request }) => {\n      const user = await getAuthUser(request);\n      const vendor = await vendorService.getVendorByUserId(user.id);\n      return success(vendor);\n    },\n    {\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Get my vendor profile',\n        description: 'Get current user vendor profile',\n      },\n    }\n  )\n\n  // Create vendor (become a vendor)\n  .post(\n    '/',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n      const validated = createVendorSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const vendor = await vendorService.createVendor(user.id, validated.data);\n      return success(vendor, 'Vendor profile created');\n    },\n    {\n      body: t.Object({\n        name: t.String(),\n        description: t.Optional(t.String()),\n        categories: t.Optional(t.Array(t.String())),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Create vendor',\n        description: 'Create a vendor profile (become a vendor)',\n      },\n    }\n  )\n\n  // Vendor/Admin routes\n  .use(requireVendorOrAdmin)\n\n  // Update vendor\n  .patch(\n    '/:vendorId',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n      const validated = updateVendorSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const vendor = await vendorService.updateVendor(\n        params.vendorId,\n        user.id,\n        user.role,\n        validated.data\n      );\n      return success(vendor, 'Vendor updated');\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      body: t.Object({\n        name: t.Optional(t.String()),\n        description: t.Optional(t.String()),\n        image: t.Optional(t.String()),\n        isOpen: t.Optional(t.Boolean()),\n        categories: t.Optional(t.Array(t.String())),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Update vendor',\n        description: 'Update vendor details',\n      },\n    }\n  )\n\n  // Toggle vendor status\n  .post(\n    '/:vendorId/toggle-status',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      const vendor = await vendorService.toggleVendorStatus(\n        params.vendorId,\n        user.id,\n        user.role\n      );\n      return success(vendor, `Shop is now ${vendor.isOpen ? 'open' : 'closed'}`);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Toggle vendor status',\n        description: 'Open/close vendor shop',\n      },\n    }\n  )\n\n  // Get vendor statistics\n  .get(\n    '/:vendorId/stats',\n    async ({ params }) => {\n      const stats = await vendorService.getVendorStats(params.vendorId);\n      return success(stats);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Get vendor stats',\n        description: 'Get vendor statistics',\n      },\n    }\n  )\n\n  // Admin routes\n  .use(requireAdmin)\n\n  // Delete vendor (admin)\n  .delete(\n    '/:vendorId',\n    async ({ params }) => {\n      await vendorService.deleteVendor(params.vendorId);\n      return success(null, 'Vendor deleted');\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Vendors'],\n        summary: 'Delete vendor',\n        description: 'Delete vendor (admin only)',\n      },\n    }\n  );\n","// Menu Item Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ForbiddenError } from '../utils/errors';\nimport { parsePagination, createPaginationMeta } from '../utils/response';\nimport type {\n  CreateMenuItemInput,\n  UpdateMenuItemInput,\n  PaginationInput,\n} from '../utils/validation';\nimport type { Role } from '@prisma/client';\n\nexport interface MenuItemResponse {\n  id: string;\n  vendorId: string;\n  name: string;\n  description: string | null;\n  price: number;\n  image: string | null;\n  category: string;\n  isAvailable: boolean;\n  preparationTime: number;\n  createdAt: Date;\n  updatedAt: Date;\n  vendor?: {\n    id: string;\n    name: string;\n    isOpen: boolean;\n  };\n}\n\n/**\n * Create menu item for a vendor\n */\nexport async function createMenuItem(\n  vendorId: string,\n  userId: string,\n  userRole: Role,\n  input: CreateMenuItemInput\n): Promise<MenuItemResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  // Check permission\n  if (vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to add menu items to this vendor');\n  }\n\n  const menuItem = await prisma.menuItem.create({\n    data: {\n      vendorId,\n      name: input.name,\n      description: input.description,\n      price: input.price,\n      category: input.category,\n      preparationTime: input.preparationTime,\n      isAvailable: input.isAvailable,\n    },\n    include: {\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          isOpen: true,\n        },\n      },\n    },\n  });\n\n  return menuItem;\n}\n\n/**\n * Get menu item by ID\n */\nexport async function getMenuItemById(\n  menuItemId: string\n): Promise<MenuItemResponse> {\n  const menuItem = await prisma.menuItem.findUnique({\n    where: { id: menuItemId },\n    include: {\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          isOpen: true,\n        },\n      },\n    },\n  });\n\n  if (!menuItem) {\n    throw new NotFoundError('Menu item');\n  }\n\n  return menuItem;\n}\n\n/**\n * Update menu item\n */\nexport async function updateMenuItem(\n  menuItemId: string,\n  userId: string,\n  userRole: Role,\n  input: UpdateMenuItemInput\n): Promise<MenuItemResponse> {\n  const menuItem = await prisma.menuItem.findUnique({\n    where: { id: menuItemId },\n    include: { vendor: true },\n  });\n\n  if (!menuItem) {\n    throw new NotFoundError('Menu item');\n  }\n\n  // Check permission\n  if (menuItem.vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this menu item');\n  }\n\n  const updated = await prisma.menuItem.update({\n    where: { id: menuItemId },\n    data: {\n      name: input.name,\n      description: input.description,\n      price: input.price,\n      image: input.image,\n      category: input.category,\n      preparationTime: input.preparationTime,\n      isAvailable: input.isAvailable,\n    },\n    include: {\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          isOpen: true,\n        },\n      },\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Delete menu item\n */\nexport async function deleteMenuItem(\n  menuItemId: string,\n  userId: string,\n  userRole: Role\n): Promise<void> {\n  const menuItem = await prisma.menuItem.findUnique({\n    where: { id: menuItemId },\n    include: { vendor: true },\n  });\n\n  if (!menuItem) {\n    throw new NotFoundError('Menu item');\n  }\n\n  // Check permission\n  if (menuItem.vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to delete this menu item');\n  }\n\n  await prisma.menuItem.delete({ where: { id: menuItemId } });\n}\n\n/**\n * Get menu items for a vendor\n */\nexport async function getVendorMenuItems(\n  vendorId: string,\n  pagination: PaginationInput,\n  filters?: {\n    category?: string;\n    isAvailable?: boolean;\n    search?: string;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = { vendorId };\n\n  if (filters?.category) {\n    where.category = filters.category;\n  }\n\n  if (filters?.isAvailable !== undefined) {\n    where.isAvailable = filters.isAvailable;\n  }\n\n  if (filters?.search) {\n    where.OR = [\n      { name: { contains: filters.search, mode: 'insensitive' } },\n      { description: { contains: filters.search, mode: 'insensitive' } },\n    ];\n  }\n\n  const [menuItems, total] = await Promise.all([\n    prisma.menuItem.findMany({\n      where,\n      include: {\n        vendor: {\n          select: {\n            id: true,\n            name: true,\n            isOpen: true,\n          },\n        },\n      },\n      orderBy: [{ category: 'asc' }, { name: 'asc' }],\n      skip,\n      take: limit,\n    }),\n    prisma.menuItem.count({ where }),\n  ]);\n\n  return {\n    items: menuItems,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Toggle menu item availability\n */\nexport async function toggleMenuItemAvailability(\n  menuItemId: string,\n  userId: string,\n  userRole: Role\n): Promise<MenuItemResponse> {\n  const menuItem = await prisma.menuItem.findUnique({\n    where: { id: menuItemId },\n    include: { vendor: true },\n  });\n\n  if (!menuItem) {\n    throw new NotFoundError('Menu item');\n  }\n\n  // Check permission\n  if (menuItem.vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this menu item');\n  }\n\n  const updated = await prisma.menuItem.update({\n    where: { id: menuItemId },\n    data: { isAvailable: !menuItem.isAvailable },\n    include: {\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          isOpen: true,\n        },\n      },\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Get all menu categories for a vendor\n */\nexport async function getVendorCategories(vendorId: string): Promise<string[]> {\n  const menuItems = await prisma.menuItem.findMany({\n    where: { vendorId },\n    select: { category: true },\n    distinct: ['category'],\n  });\n\n  return menuItems.map((item) => item.category).sort();\n}\n\n/**\n * Bulk update menu item availability\n */\nexport async function bulkUpdateAvailability(\n  vendorId: string,\n  userId: string,\n  userRole: Role,\n  menuItemIds: string[],\n  isAvailable: boolean\n): Promise<number> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  // Check permission\n  if (vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update menu items');\n  }\n\n  const result = await prisma.menuItem.updateMany({\n    where: {\n      id: { in: menuItemIds },\n      vendorId,\n    },\n    data: { isAvailable },\n  });\n\n  return result.count;\n}\n","// Menu Controller\nimport { Elysia, t } from 'elysia';\nimport * as menuService from '../services/menu.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport {\n  authPlugin,\n  requireAuth,\n  requireVendorOrAdmin,\n} from '../middlewares/auth.middleware';\nimport { success, paginated } from '../utils/response';\nimport {\n  createMenuItemSchema,\n  updateMenuItemSchema,\n  paginationSchema,\n} from '../utils/validation';\nimport { BadRequestError, UnauthorizedError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\nexport const menuController = new Elysia({ prefix: '/menu' })\n  // Public routes\n  .use(authPlugin)\n\n  // Get menu item by ID\n  .get(\n    '/:menuItemId',\n    async ({ params }) => {\n      const menuItem = await menuService.getMenuItemById(params.menuItemId);\n      return success(menuItem);\n    },\n    {\n      params: t.Object({\n        menuItemId: t.String(),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Get menu item',\n        description: 'Get menu item details',\n      },\n    }\n  )\n\n  // Protected routes\n  .use(requireAuth)\n  .use(requireVendorOrAdmin)\n\n  // Update menu item\n  .patch(\n    '/:menuItemId',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n      const validated = updateMenuItemSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const menuItem = await menuService.updateMenuItem(\n        params.menuItemId,\n        user.id,\n        user.role,\n        validated.data\n      );\n      return success(menuItem, 'Menu item updated');\n    },\n    {\n      params: t.Object({\n        menuItemId: t.String(),\n      }),\n      body: t.Object({\n        name: t.Optional(t.String()),\n        description: t.Optional(t.String()),\n        price: t.Optional(t.Number()),\n        image: t.Optional(t.String()),\n        category: t.Optional(t.String()),\n        preparationTime: t.Optional(t.Number()),\n        isAvailable: t.Optional(t.Boolean()),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Update menu item',\n        description: 'Update menu item details',\n      },\n    }\n  )\n\n  // Toggle menu item availability\n  .post(\n    '/:menuItemId/toggle-availability',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      const menuItem = await menuService.toggleMenuItemAvailability(\n        params.menuItemId,\n        user.id,\n        user.role\n      );\n      return success(\n        menuItem,\n        `Menu item is now ${menuItem.isAvailable ? 'available' : 'unavailable'}`\n      );\n    },\n    {\n      params: t.Object({\n        menuItemId: t.String(),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Toggle availability',\n        description: 'Toggle menu item availability',\n      },\n    }\n  )\n\n  // Delete menu item\n  .delete(\n    '/:menuItemId',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      await menuService.deleteMenuItem(params.menuItemId, user.id, user.role);\n      return success(null, 'Menu item deleted');\n    },\n    {\n      params: t.Object({\n        menuItemId: t.String(),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Delete menu item',\n        description: 'Delete menu item',\n      },\n    }\n  );\n\n// Vendor Menu Routes (nested under /vendors/:vendorId/menu)\nexport const vendorMenuController = new Elysia({ prefix: '/vendors/:vendorId/menu' })\n  .use(authPlugin)\n\n  // Get vendor's menu items (public)\n  .get(\n    '/',\n    async ({ params, query }) => {\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n      const result = await menuService.getVendorMenuItems(\n        params.vendorId,\n        paginationData,\n        {\n          category: query.category,\n          isAvailable:\n            query.isAvailable === 'true'\n              ? true\n              : query.isAvailable === 'false'\n              ? false\n              : undefined,\n          search: query.search,\n        }\n      );\n      return paginated(result);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        category: t.Optional(t.String()),\n        isAvailable: t.Optional(t.String()),\n        search: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Get vendor menu',\n        description: 'Get all menu items for a vendor',\n      },\n    }\n  )\n\n  // Get vendor's menu categories\n  .get(\n    '/categories',\n    async ({ params }) => {\n      const categories = await menuService.getVendorCategories(params.vendorId);\n      return success(categories);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Get vendor categories',\n        description: 'Get all menu categories for a vendor',\n      },\n    }\n  )\n\n  // Protected routes\n  .use(requireAuth)\n  .use(requireVendorOrAdmin)\n\n  // Create menu item for vendor\n  .post(\n    '/',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n      const validated = createMenuItemSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const menuItem = await menuService.createMenuItem(\n        params.vendorId,\n        user.id,\n        user.role,\n        validated.data\n      );\n      return success(menuItem, 'Menu item created');\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      body: t.Object({\n        name: t.String(),\n        description: t.Optional(t.String()),\n        price: t.Number(),\n        category: t.String(),\n        preparationTime: t.Optional(t.Number()),\n        isAvailable: t.Optional(t.Boolean()),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Create menu item',\n        description: 'Create a new menu item for vendor',\n      },\n    }\n  )\n\n  // Bulk update availability\n  .post(\n    '/bulk-availability',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n      const count = await menuService.bulkUpdateAvailability(\n        params.vendorId,\n        user.id,\n        user.role,\n        body.menuItemIds,\n        body.isAvailable\n      );\n      return success({ updatedCount: count }, `${count} menu items updated`);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      body: t.Object({\n        menuItemIds: t.Array(t.String()),\n        isAvailable: t.Boolean(),\n      }),\n      detail: {\n        tags: ['Menu'],\n        summary: 'Bulk update availability',\n        description: 'Update availability for multiple menu items',\n      },\n    }\n  );\n","// Reservation Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ForbiddenError, BadRequestError } from '../utils/errors';\nimport { parsePagination, createPaginationMeta } from '../utils/response';\nimport type { CreateReservationInput, PaginationInput } from '../utils/validation';\nimport type { Role, ReservationStatus } from '@prisma/client';\nimport {\n  sendOrderConfirmedEmail,\n  sendOrderPreparingEmail,\n  sendOrderReadyEmail,\n  sendOrderCompletedEmail,\n  sendOrderCancelledEmail,\n} from './email.service';\n\nexport interface ReservationResponse {\n  id: string;\n  customerId: string;\n  vendorId: string;\n  timeSlotId: string;\n  customerName: string;\n  customerContact: string;\n  paymentMethod: string;\n  status: ReservationStatus;\n  totalAmount: number;\n  queueNumber: number;\n  notes: string | null;\n  createdAt: Date;\n  updatedAt: Date;\n  confirmedAt: Date | null;\n  completedAt: Date | null;\n  items: {\n    id: string;\n    menuItemId: string;\n    name: string;\n    price: number;\n    quantity: number;\n  }[];\n  vendor?: {\n    id: string;\n    name: string;\n    image: string | null;\n  };\n  customer?: {\n    id: string;\n    name: string;\n    email: string;\n  };\n  timeSlot?: {\n    id: string;\n    label: string;\n    startTime: string;\n    endTime: string;\n    period: string;\n  };\n}\n\n/**\n * Generate queue number for today\n */\nasync function generateQueueNumber(vendorId: string): Promise<number> {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  const lastReservation = await prisma.reservation.findFirst({\n    where: {\n      vendorId,\n      createdAt: { gte: today },\n    },\n    orderBy: { queueNumber: 'desc' },\n  });\n\n  return (lastReservation?.queueNumber || 0) + 1;\n}\n\n/**\n * Create reservation\n */\nexport async function createReservation(\n  customerId: string,\n  input: CreateReservationInput\n): Promise<ReservationResponse> {\n  // Verify vendor exists and is open\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: input.vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  if (!vendor.isOpen) {\n    throw new BadRequestError('This vendor is currently closed');\n  }\n\n  // Verify time slot exists\n  const timeSlot = await prisma.timeSlot.findUnique({\n    where: { id: input.timeSlotId },\n  });\n\n  if (!timeSlot) {\n    throw new NotFoundError('Time slot');\n  }\n\n  // Get menu items and calculate total\n  const menuItemIds = input.items.map((item) => item.menuItemId);\n  const menuItems = await prisma.menuItem.findMany({\n    where: {\n      id: { in: menuItemIds },\n      vendorId: input.vendorId,\n    },\n  });\n\n  if (menuItems.length !== menuItemIds.length) {\n    throw new BadRequestError('Some menu items are not found or not available');\n  }\n\n  // Check all items are available\n  const unavailableItems = menuItems.filter((item) => !item.isAvailable);\n  if (unavailableItems.length > 0) {\n    throw new BadRequestError(\n      `Some items are not available: ${unavailableItems.map((i) => i.name).join(', ')}`\n    );\n  }\n\n  // Calculate total amount\n  let totalAmount = 0;\n  const reservationItems = input.items.map((inputItem) => {\n    const menuItem = menuItems.find((m) => m.id === inputItem.menuItemId)!;\n    const itemTotal = menuItem.price * inputItem.quantity;\n    totalAmount += itemTotal;\n\n    return {\n      menuItemId: menuItem.id,\n      name: menuItem.name,\n      price: menuItem.price,\n      quantity: inputItem.quantity,\n    };\n  });\n\n  // Generate queue number\n  const queueNumber = await generateQueueNumber(input.vendorId);\n\n  // Create reservation with items\n  const reservation = await prisma.reservation.create({\n    data: {\n      customerId,\n      vendorId: input.vendorId,\n      timeSlotId: input.timeSlotId,\n      customerName: input.customerName,\n      customerContact: input.customerContact,\n      paymentMethod: input.paymentMethod,\n      totalAmount,\n      queueNumber,\n      notes: input.notes,\n      items: {\n        create: reservationItems,\n      },\n    },\n    include: {\n      items: true,\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n      customer: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n      timeSlot: {\n        select: {\n          id: true,\n          label: true,\n          startTime: true,\n          endTime: true,\n          period: true,\n        },\n      },\n    },\n  });\n\n  // Update vendor total orders\n  await prisma.vendor.update({\n    where: { id: input.vendorId },\n    data: { totalOrders: { increment: 1 } },\n  });\n\n  return reservation;\n}\n\n/**\n * Get reservation by ID\n */\nexport async function getReservationById(\n  reservationId: string,\n  userId: string,\n  userRole: Role\n): Promise<ReservationResponse> {\n  const reservation = await prisma.reservation.findUnique({\n    where: { id: reservationId },\n    include: {\n      items: true,\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n          userId: true,\n        },\n      },\n      customer: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n      timeSlot: {\n        select: {\n          id: true,\n          label: true,\n          startTime: true,\n          endTime: true,\n          period: true,\n        },\n      },\n    },\n  });\n\n  if (!reservation) {\n    throw new NotFoundError('Reservation');\n  }\n\n  // Check permission\n  const isOwner = reservation.customerId === userId;\n  const isVendorOwner = (reservation.vendor as any)?.userId === userId;\n\n  if (!isOwner && !isVendorOwner && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to view this reservation');\n  }\n\n  return reservation;\n}\n\n/**\n * Update reservation status\n */\nexport async function updateReservationStatus(\n  reservationId: string,\n  userId: string,\n  userRole: Role,\n  status: ReservationStatus\n): Promise<ReservationResponse> {\n  const reservation = await prisma.reservation.findUnique({\n    where: { id: reservationId },\n    include: { vendor: true },\n  });\n\n  if (!reservation) {\n    throw new NotFoundError('Reservation');\n  }\n\n  // Check permission - only vendor owner or admin can update status\n  const isVendorOwner = reservation.vendor.userId === userId;\n  if (!isVendorOwner && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this reservation');\n  }\n\n  // Admin can change status freely, vendor follows transition rules\n  if (userRole !== 'ADMIN') {\n    // Validate status transition for non-admin\n    const validTransitions: Record<ReservationStatus, ReservationStatus[]> = {\n      PENDING: ['CONFIRMED', 'CANCELLED'],\n      CONFIRMED: ['PREPARING', 'CANCELLED'],\n      PREPARING: ['READY', 'CANCELLED'],\n      READY: ['COMPLETED', 'CANCELLED'],\n      COMPLETED: [],\n      CANCELLED: [],\n    };\n\n    if (!validTransitions[reservation.status].includes(status)) {\n      throw new BadRequestError(\n        `Cannot change status from ${reservation.status} to ${status}`\n      );\n    }\n  }\n\n  const updateData: any = { status };\n\n  if (status === 'CONFIRMED') {\n    updateData.confirmedAt = new Date();\n  } else if (status === 'COMPLETED') {\n    updateData.completedAt = new Date();\n  }\n\n  const updated = await prisma.reservation.update({\n    where: { id: reservationId },\n    data: updateData,\n    include: {\n      items: true,\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n      customer: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n      timeSlot: {\n        select: {\n          id: true,\n          label: true,\n          startTime: true,\n          endTime: true,\n          period: true,\n        },\n      },\n    },\n  });\n\n  // Send email notification based on status change\n  if (updated.customer?.email) {\n    const orderDetails = {\n      queueNumber: updated.queueNumber,\n      vendorName: updated.vendor?.name || '‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤',\n      customerName: updated.customer.name,\n      items: updated.items.map((item) => ({\n        name: item.name,\n        quantity: item.quantity,\n        price: item.price,\n      })),\n      totalAmount: updated.totalAmount,\n      timeSlot: updated.timeSlot ? `${updated.timeSlot.startTime} - ${updated.timeSlot.endTime}` : undefined,\n    };\n\n    // Send notification email (fire and forget - don't block response)\n    (async () => {\n      try {\n        switch (status) {\n          case 'CONFIRMED':\n            await sendOrderConfirmedEmail(updated.customer!.email, orderDetails);\n            break;\n          case 'PREPARING':\n            await sendOrderPreparingEmail(updated.customer!.email, orderDetails);\n            break;\n          case 'READY':\n            await sendOrderReadyEmail(updated.customer!.email, orderDetails);\n            break;\n          case 'COMPLETED':\n            await sendOrderCompletedEmail(updated.customer!.email, orderDetails);\n            break;\n          case 'CANCELLED':\n            await sendOrderCancelledEmail(updated.customer!.email, orderDetails);\n            break;\n        }\n        console.log(`[Reservation] Status notification sent for order #${updated.queueNumber} (${status})`);\n      } catch (error) {\n        console.error(`[Reservation] Failed to send status notification:`, error);\n      }\n    })();\n  }\n\n  return updated;\n}\n\n/**\n * Cancel reservation (by customer)\n */\nexport async function cancelReservation(\n  reservationId: string,\n  userId: string,\n  userRole: Role\n): Promise<ReservationResponse> {\n  const reservation = await prisma.reservation.findUnique({\n    where: { id: reservationId },\n    include: { vendor: true },\n  });\n\n  if (!reservation) {\n    throw new NotFoundError('Reservation');\n  }\n\n  // Check permission - customer, vendor owner, or admin\n  const isOwner = reservation.customerId === userId;\n  const isVendorOwner = reservation.vendor.userId === userId;\n\n  if (!isOwner && !isVendorOwner && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to cancel this reservation');\n  }\n\n  // Can only cancel pending or confirmed reservations\n  if (!['PENDING', 'CONFIRMED'].includes(reservation.status)) {\n    throw new BadRequestError(\n      'Can only cancel pending or confirmed reservations'\n    );\n  }\n\n  const updated = await prisma.reservation.update({\n    where: { id: reservationId },\n    data: { status: 'CANCELLED' },\n    include: {\n      items: true,\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n      customer: {\n        select: {\n          id: true,\n          name: true,\n          email: true,\n        },\n      },\n      timeSlot: {\n        select: {\n          id: true,\n          label: true,\n          startTime: true,\n          endTime: true,\n          period: true,\n        },\n      },\n    },\n  });\n\n  // Send cancellation email notification\n  if (updated.customer?.email) {\n    const orderDetails = {\n      queueNumber: updated.queueNumber,\n      vendorName: updated.vendor?.name || '‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤',\n      customerName: updated.customer.name,\n      items: updated.items.map((item) => ({\n        name: item.name,\n        quantity: item.quantity,\n        price: item.price,\n      })),\n      totalAmount: updated.totalAmount,\n    };\n\n    // Fire and forget\n    sendOrderCancelledEmail(updated.customer.email, orderDetails).catch((error) => {\n      console.error(`[Reservation] Failed to send cancellation email:`, error);\n    });\n  }\n\n  return updated;\n}\n\n/**\n * Get customer's reservations\n */\nexport async function getCustomerReservations(\n  customerId: string,\n  pagination: PaginationInput,\n  filters?: {\n    status?: ReservationStatus;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = { customerId };\n\n  if (filters?.status) {\n    where.status = filters.status;\n  }\n\n  const [reservations, total] = await Promise.all([\n    prisma.reservation.findMany({\n      where,\n      include: {\n        items: true,\n        vendor: {\n          select: {\n            id: true,\n            name: true,\n            image: true,\n          },\n        },\n        timeSlot: {\n          select: {\n            id: true,\n            label: true,\n            startTime: true,\n            endTime: true,\n            period: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      skip,\n      take: limit,\n    }),\n    prisma.reservation.count({ where }),\n  ]);\n\n  return {\n    items: reservations,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get vendor's reservations\n */\nexport async function getVendorReservations(\n  vendorId: string,\n  userId: string,\n  userRole: Role,\n  pagination: PaginationInput,\n  filters?: {\n    status?: ReservationStatus;\n    date?: string; // YYYY-MM-DD\n  }\n) {\n  // Verify vendor access\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  if (vendor.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to view these reservations');\n  }\n\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = { vendorId };\n\n  if (filters?.status) {\n    where.status = filters.status;\n  }\n\n  if (filters?.date) {\n    const startDate = new Date(filters.date);\n    startDate.setHours(0, 0, 0, 0);\n    const endDate = new Date(filters.date);\n    endDate.setHours(23, 59, 59, 999);\n\n    where.createdAt = {\n      gte: startDate,\n      lte: endDate,\n    };\n  }\n\n  const [reservations, total] = await Promise.all([\n    prisma.reservation.findMany({\n      where,\n      include: {\n        items: true,\n        customer: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n          },\n        },\n        timeSlot: {\n          select: {\n            id: true,\n            label: true,\n            startTime: true,\n            endTime: true,\n            period: true,\n          },\n        },\n      },\n      orderBy: [{ status: 'asc' }, { queueNumber: 'asc' }],\n      skip,\n      take: limit,\n    }),\n    prisma.reservation.count({ where }),\n  ]);\n\n  return {\n    items: reservations,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get all reservations (admin)\n */\nexport async function getAllReservations(\n  pagination: PaginationInput,\n  filters?: {\n    status?: ReservationStatus;\n    vendorId?: string;\n    date?: string;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = {};\n\n  if (filters?.status) {\n    where.status = filters.status;\n  }\n\n  if (filters?.vendorId) {\n    where.vendorId = filters.vendorId;\n  }\n\n  if (filters?.date) {\n    const startDate = new Date(filters.date);\n    startDate.setHours(0, 0, 0, 0);\n    const endDate = new Date(filters.date);\n    endDate.setHours(23, 59, 59, 999);\n\n    where.createdAt = {\n      gte: startDate,\n      lte: endDate,\n    };\n  }\n\n  const [reservations, total] = await Promise.all([\n    prisma.reservation.findMany({\n      where,\n      include: {\n        items: true,\n        vendor: {\n          select: {\n            id: true,\n            name: true,\n            image: true,\n          },\n        },\n        customer: {\n          select: {\n            id: true,\n            name: true,\n            email: true,\n          },\n        },\n        timeSlot: {\n          select: {\n            id: true,\n            label: true,\n            startTime: true,\n            endTime: true,\n            period: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      skip,\n      take: limit,\n    }),\n    prisma.reservation.count({ where }),\n  ]);\n\n  return {\n    items: reservations,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get reservation statistics\n */\nexport async function getReservationStats(vendorId?: string) {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  const where: any = vendorId ? { vendorId } : {};\n\n  const [total, pending, confirmed, preparing, ready, completed, cancelled, todayCount, todayRevenue] =\n    await Promise.all([\n      prisma.reservation.count({ where }),\n      prisma.reservation.count({ where: { ...where, status: 'PENDING' } }),\n      prisma.reservation.count({ where: { ...where, status: 'CONFIRMED' } }),\n      prisma.reservation.count({ where: { ...where, status: 'PREPARING' } }),\n      prisma.reservation.count({ where: { ...where, status: 'READY' } }),\n      prisma.reservation.count({ where: { ...where, status: 'COMPLETED' } }),\n      prisma.reservation.count({ where: { ...where, status: 'CANCELLED' } }),\n      prisma.reservation.count({\n        where: { ...where, createdAt: { gte: today } },\n      }),\n      prisma.reservation.aggregate({\n        where: {\n          ...where,\n          status: 'COMPLETED',\n          createdAt: { gte: today },\n        },\n        _sum: { totalAmount: true },\n      }),\n    ]);\n\n  return {\n    total,\n    byStatus: {\n      pending,\n      confirmed,\n      preparing,\n      ready,\n      completed,\n      cancelled,\n    },\n    today: {\n      count: todayCount,\n      revenue: todayRevenue._sum.totalAmount || 0,\n    },\n  };\n}\n","// Reservation Controller\nimport { Elysia, t } from 'elysia';\nimport { bearer } from '@elysiajs/bearer';\nimport * as reservationService from '../services/reservation.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport {\n  requireAuth,\n  requireVendorOrAdmin,\n  requireAdmin,\n} from '../middlewares/auth.middleware';\nimport { success, paginated } from '../utils/response';\nimport {\n  createReservationSchema,\n  updateReservationStatusSchema,\n  paginationSchema,\n} from '../utils/validation';\nimport { BadRequestError, UnauthorizedError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\nexport const reservationController = new Elysia({ prefix: '/reservations' })\n  .use(bearer())\n\n  // Create reservation\n  .post(\n    '/',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n\n      const validated = createReservationSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const reservation = await reservationService.createReservation(\n        user.id,\n        validated.data\n      );\n      return success(reservation, 'Reservation created successfully');\n    },\n    {\n      body: t.Object({\n        vendorId: t.String(),\n        timeSlotId: t.String(),\n        customerName: t.String(),\n        customerContact: t.String(),\n        paymentMethod: t.Union([t.Literal('CASH'), t.Literal('BANK_TRANSFER')]),\n        items: t.Array(\n          t.Object({\n            menuItemId: t.String(),\n            quantity: t.Number(),\n          })\n        ),\n        notes: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Create reservation',\n        description: 'Create a new food reservation',\n      },\n    }\n  )\n\n  // Get my reservations\n  .get(\n    '/me',\n    async ({ request, query }) => {\n      const user = await getAuthUser(request);\n\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n      const result = await reservationService.getCustomerReservations(\n        user.id,\n        paginationData,\n        {\n          status: query.status as any,\n        }\n      );\n      return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        status: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Get my reservations',\n        description: 'Get current user reservations',\n      },\n    }\n  )\n\n  // Get reservation by ID\n  .get(\n    '/:reservationId',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      const reservation = await reservationService.getReservationById(\n        params.reservationId,\n        user.id,\n        user.role\n      );\n      return success(reservation);\n    },\n    {\n      params: t.Object({\n        reservationId: t.String(),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Get reservation',\n        description: 'Get reservation details',\n      },\n    }\n  )\n\n  // Cancel reservation\n  .post(\n    '/:reservationId/cancel',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      const reservation = await reservationService.cancelReservation(\n        params.reservationId,\n        user.id,\n        user.role\n      );\n      return success(reservation, 'Reservation cancelled');\n    },\n    {\n      params: t.Object({\n        reservationId: t.String(),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Cancel reservation',\n        description: 'Cancel a reservation',\n      },\n    }\n  )\n\n  // Vendor/Admin routes\n  .use(requireVendorOrAdmin)\n\n  // Update reservation status\n  .patch(\n    '/:reservationId/status',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n      const validated = updateReservationStatusSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const reservation = await reservationService.updateReservationStatus(\n        params.reservationId,\n        user.id,\n        user.role,\n        validated.data.status\n      );\n      return success(reservation, `Status updated to ${validated.data.status}`);\n    },\n    {\n      params: t.Object({\n        reservationId: t.String(),\n      }),\n      body: t.Object({\n        status: t.Union([\n          t.Literal('PENDING'),\n          t.Literal('CONFIRMED'),\n          t.Literal('PREPARING'),\n          t.Literal('READY'),\n          t.Literal('COMPLETED'),\n          t.Literal('CANCELLED'),\n        ]),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Update status',\n        description: 'Update reservation status',\n      },\n    }\n  )\n\n  // Admin routes\n  .use(requireAdmin)\n\n  // Get all reservations (admin)\n  .get(\n    '/',\n    async ({ query }) => {\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n      const result = await reservationService.getAllReservations(\n        paginationData,\n        {\n          status: query.status as any,\n          vendorId: query.vendorId,\n          date: query.date,\n        }\n      );\n      return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        status: t.Optional(t.String()),\n        vendorId: t.Optional(t.String()),\n        date: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'List all reservations',\n        description: 'Get all reservations (admin only)',\n      },\n    }\n  )\n\n  // Get reservation stats (admin)\n  .get(\n    '/stats/overview',\n    async ({ query }) => {\n      const stats = await reservationService.getReservationStats(query.vendorId);\n      return success(stats);\n    },\n    {\n      query: t.Object({\n        vendorId: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Get statistics',\n        description: 'Get reservation statistics',\n      },\n    }\n  );\n\n// Vendor Reservations Routes\nexport const vendorReservationsController = new Elysia({\n  prefix: '/vendors/:vendorId/reservations',\n})\n  .use(requireAuth)\n  .use(requireVendorOrAdmin)\n\n  // Get vendor's reservations\n  .get(\n    '/',\n    async ({ request, params, query }) => {\n      const user = await getAuthUser(request);\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n      const result = await reservationService.getVendorReservations(\n        params.vendorId,\n        user.id,\n        user.role,\n        paginationData,\n        {\n          status: query.status as any,\n          date: query.date,\n        }\n      );\n      return paginated(result);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        status: t.Optional(t.String()),\n        date: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Get vendor reservations',\n        description: 'Get reservations for a vendor',\n      },\n    }\n  )\n\n  // Get vendor reservation stats\n  .get(\n    '/stats',\n    async ({ params }) => {\n      const stats = await reservationService.getReservationStats(params.vendorId);\n      return success(stats);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Reservations'],\n        summary: 'Get vendor stats',\n        description: 'Get reservation statistics for a vendor',\n      },\n    }\n  );\n","// Time Slot Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ForbiddenError } from '../utils/errors';\nimport type { CreateTimeSlotInput } from '../utils/validation';\nimport type { Role, Period } from '@prisma/client';\n\nexport interface TimeSlotResponse {\n  id: string;\n  vendorId: string | null;\n  label: string;\n  startTime: string;\n  endTime: string;\n  period: Period;\n  isActive: boolean;\n  maxOrders: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Create time slot\n */\nexport async function createTimeSlot(\n  vendorId: string | null,\n  userId: string,\n  userRole: Role,\n  input: CreateTimeSlotInput\n): Promise<TimeSlotResponse> {\n  // If vendorId is provided, verify permission\n  if (vendorId) {\n    const vendor = await prisma.vendor.findUnique({\n      where: { id: vendorId },\n    });\n\n    if (!vendor) {\n      throw new NotFoundError('Vendor');\n    }\n\n    if (vendor.userId !== userId && userRole !== 'ADMIN') {\n      throw new ForbiddenError('Not authorized to create time slots for this vendor');\n    }\n  } else if (userRole !== 'ADMIN') {\n    throw new ForbiddenError('Only admin can create global time slots');\n  }\n\n  const timeSlot = await prisma.timeSlot.create({\n    data: {\n      vendorId,\n      label: input.label,\n      startTime: input.startTime,\n      endTime: input.endTime,\n      period: input.period,\n      maxOrders: input.maxOrders,\n    },\n  });\n\n  return timeSlot;\n}\n\n/**\n * Get time slots (global or vendor-specific)\n */\nexport async function getTimeSlots(vendorId?: string): Promise<TimeSlotResponse[]> {\n  const timeSlots = await prisma.timeSlot.findMany({\n    where: {\n      OR: [\n        { vendorId: null }, // Global time slots\n        { vendorId: vendorId || undefined }, // Vendor-specific\n      ],\n      isActive: true,\n    },\n    orderBy: [{ period: 'asc' }, { startTime: 'asc' }],\n  });\n\n  return timeSlots;\n}\n\n/**\n * Get time slot by ID\n */\nexport async function getTimeSlotById(timeSlotId: string): Promise<TimeSlotResponse> {\n  const timeSlot = await prisma.timeSlot.findUnique({\n    where: { id: timeSlotId },\n  });\n\n  if (!timeSlot) {\n    throw new NotFoundError('Time slot');\n  }\n\n  return timeSlot;\n}\n\n/**\n * Update time slot\n */\nexport async function updateTimeSlot(\n  timeSlotId: string,\n  userId: string,\n  userRole: Role,\n  input: Partial<CreateTimeSlotInput & { isActive: boolean }>\n): Promise<TimeSlotResponse> {\n  const timeSlot = await prisma.timeSlot.findUnique({\n    where: { id: timeSlotId },\n    include: { vendor: true },\n  });\n\n  if (!timeSlot) {\n    throw new NotFoundError('Time slot');\n  }\n\n  // Check permission\n  if (timeSlot.vendor) {\n    if (timeSlot.vendor.userId !== userId && userRole !== 'ADMIN') {\n      throw new ForbiddenError('Not authorized to update this time slot');\n    }\n  } else if (userRole !== 'ADMIN') {\n    throw new ForbiddenError('Only admin can update global time slots');\n  }\n\n  const updated = await prisma.timeSlot.update({\n    where: { id: timeSlotId },\n    data: {\n      label: input.label,\n      startTime: input.startTime,\n      endTime: input.endTime,\n      period: input.period,\n      maxOrders: input.maxOrders,\n      isActive: input.isActive,\n    },\n  });\n\n  return updated;\n}\n\n/**\n * Delete time slot\n */\nexport async function deleteTimeSlot(\n  timeSlotId: string,\n  userId: string,\n  userRole: Role\n): Promise<void> {\n  const timeSlot = await prisma.timeSlot.findUnique({\n    where: { id: timeSlotId },\n    include: { vendor: true },\n  });\n\n  if (!timeSlot) {\n    throw new NotFoundError('Time slot');\n  }\n\n  // Check permission\n  if (timeSlot.vendor) {\n    if (timeSlot.vendor.userId !== userId && userRole !== 'ADMIN') {\n      throw new ForbiddenError('Not authorized to delete this time slot');\n    }\n  } else if (userRole !== 'ADMIN') {\n    throw new ForbiddenError('Only admin can delete global time slots');\n  }\n\n  await prisma.timeSlot.delete({ where: { id: timeSlotId } });\n}\n\n/**\n * Get available time slots for a vendor (considering capacity)\n */\nexport async function getAvailableTimeSlots(\n  vendorId: string,\n  date: string\n): Promise<(TimeSlotResponse & { availableSlots: number; totalReservations: number })[]> {\n  const startDate = new Date(date);\n  startDate.setHours(0, 0, 0, 0);\n  const endDate = new Date(date);\n  endDate.setHours(23, 59, 59, 999);\n\n  const timeSlots = await prisma.timeSlot.findMany({\n    where: {\n      OR: [{ vendorId: null }, { vendorId }],\n      isActive: true,\n    },\n    include: {\n      reservations: {\n        where: {\n          vendorId,\n          createdAt: {\n            gte: startDate,\n            lte: endDate,\n          },\n          status: {\n            notIn: ['CANCELLED'],\n          },\n        },\n      },\n    },\n    orderBy: [{ period: 'asc' }, { startTime: 'asc' }],\n  });\n\n  return timeSlots.map((slot) => ({\n    ...slot,\n    totalReservations: slot.reservations.length,\n    availableSlots: slot.maxOrders - slot.reservations.length,\n  }));\n}\n","// Time Slot Controller\nimport { Elysia, t } from 'elysia';\nimport * as timeSlotService from '../services/timeslot.service';\nimport {\n  authPlugin,\n  requireAuth,\n  requireVendorOrAdmin,\n  requireAdmin,\n  type AuthUser,\n} from '../middlewares/auth.middleware';\nimport { success } from '../utils/response';\nimport { createTimeSlotSchema } from '../utils/validation';\nimport { BadRequestError } from '../utils/errors';\n\n// Type helper for authenticated context\ntype AuthCtx = { user: AuthUser };\n\nexport const timeSlotController = new Elysia({ prefix: '/time-slots' })\n  .use(authPlugin)\n\n  // Get all time slots (public)\n  .get(\n    '/',\n    async ({ query }) => {\n      const timeSlots = await timeSlotService.getTimeSlots(query.vendorId);\n      return success(timeSlots);\n    },\n    {\n      query: t.Object({\n        vendorId: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Get time slots',\n        description: 'Get all active time slots',\n      },\n    }\n  )\n\n  // Get available time slots for a vendor\n  .get(\n    '/available',\n    async ({ query }) => {\n      if (!query.vendorId || !query.date) {\n        throw new BadRequestError('vendorId and date are required');\n      }\n      const timeSlots = await timeSlotService.getAvailableTimeSlots(\n        query.vendorId,\n        query.date\n      );\n      return success(timeSlots);\n    },\n    {\n      query: t.Object({\n        vendorId: t.String(),\n        date: t.String(),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Get available slots',\n        description: 'Get available time slots for a vendor on a specific date',\n      },\n    }\n  )\n\n  // Get time slot by ID\n  .get(\n    '/:timeSlotId',\n    async ({ params }) => {\n      const timeSlot = await timeSlotService.getTimeSlotById(params.timeSlotId);\n      return success(timeSlot);\n    },\n    {\n      params: t.Object({\n        timeSlotId: t.String(),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Get time slot',\n        description: 'Get time slot details',\n      },\n    }\n  )\n\n  // Protected routes\n  .use(requireAuth)\n  .use(requireVendorOrAdmin)\n\n  // Create time slot for a vendor\n  .post(\n    '/',\n    async (ctx) => {\n      const { user, body } = ctx as unknown as AuthCtx & { body: any };\n      const validated = createTimeSlotSchema.safeParse(body);\n      if (!validated.success) {\n        throw new BadRequestError(validated.error.errors[0].message);\n      }\n\n      const timeSlot = await timeSlotService.createTimeSlot(\n        body.vendorId || null,\n        user.id,\n        user.role,\n        validated.data\n      );\n      return success(timeSlot, 'Time slot created');\n    },\n    {\n      body: t.Object({\n        vendorId: t.Optional(t.String()),\n        label: t.String(),\n        startTime: t.String(),\n        endTime: t.String(),\n        period: t.Union([t.Literal('MORNING'), t.Literal('AFTERNOON')]),\n        maxOrders: t.Optional(t.Number()),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Create time slot',\n        description: 'Create a new time slot',\n      },\n    }\n  )\n\n  // Update time slot\n  .patch(\n    '/:timeSlotId',\n    async (ctx) => {\n      const { user, params, body } = ctx as unknown as AuthCtx & { params: { timeSlotId: string }; body: any };\n      const timeSlot = await timeSlotService.updateTimeSlot(\n        params.timeSlotId,\n        user.id,\n        user.role,\n        body\n      );\n      return success(timeSlot, 'Time slot updated');\n    },\n    {\n      params: t.Object({\n        timeSlotId: t.String(),\n      }),\n      body: t.Object({\n        label: t.Optional(t.String()),\n        startTime: t.Optional(t.String()),\n        endTime: t.Optional(t.String()),\n        period: t.Optional(t.Union([t.Literal('MORNING'), t.Literal('AFTERNOON')])),\n        maxOrders: t.Optional(t.Number()),\n        isActive: t.Optional(t.Boolean()),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Update time slot',\n        description: 'Update time slot details',\n      },\n    }\n  )\n\n  // Delete time slot\n  .delete(\n    '/:timeSlotId',\n    async (ctx) => {\n      const { user, params } = ctx as unknown as AuthCtx & { params: { timeSlotId: string } };\n      await timeSlotService.deleteTimeSlot(params.timeSlotId, user.id, user.role);\n      return success(null, 'Time slot deleted');\n    },\n    {\n      params: t.Object({\n        timeSlotId: t.String(),\n      }),\n      detail: {\n        tags: ['Time Slots'],\n        summary: 'Delete time slot',\n        description: 'Delete a time slot',\n      },\n    }\n  );\n","// Cloudinary Configuration\n// Image upload and management\n\nimport { v2 as cloudinary, UploadApiOptions, UploadApiResponse } from 'cloudinary';\nimport { env } from './env';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: env.CLOUDINARY_CLOUD_NAME,\n  api_key: env.CLOUDINARY_API_KEY,\n  api_secret: env.CLOUDINARY_API_SECRET,\n  secure: true,\n});\n\nexport type UploadFolder = 'avatars' | 'vendors' | 'menus' | 'banners' | 'reviews';\n\nexport interface UploadResult {\n  url: string;\n  publicId: string;\n  format: string;\n  width: number;\n  height: number;\n  bytes: number;\n}\n\n// Upload options per folder\nconst folderOptions: Record<UploadFolder, UploadApiOptions> = {\n  avatars: {\n    folder: 'reservation/avatars',\n    transformation: [\n      { width: 200, height: 200, crop: 'fill', gravity: 'face' },\n      { quality: 'auto:good' },\n      { format: 'auto' },\n    ],\n  },\n  vendors: {\n    folder: 'reservation/vendors',\n    transformation: [\n      { width: 800, height: 600, crop: 'fill' },\n      { quality: 'auto:good' },\n      { format: 'auto' },\n    ],\n  },\n  menus: {\n    folder: 'reservation/menus',\n    transformation: [\n      { width: 400, height: 400, crop: 'fill' },\n      { quality: 'auto:good' },\n      { format: 'auto' },\n    ],\n  },\n  banners: {\n    folder: 'reservation/banners',\n    transformation: [\n      { width: 1920, height: 600, crop: 'fill' },\n      { quality: 'auto:good' },\n      { format: 'auto' },\n    ],\n  },\n  reviews: {\n    folder: 'reservation/reviews',\n    transformation: [\n      { width: 800, height: 800, crop: 'limit' },\n      { quality: 'auto:good' },\n      { format: 'auto' },\n    ],\n  },\n};\n\n/**\n * Upload image from base64 or URL\n */\nexport async function uploadImage(\n  file: string, // base64 or URL\n  folder: UploadFolder,\n  publicId?: string\n): Promise<UploadResult> {\n  const options: UploadApiOptions = {\n    ...folderOptions[folder],\n    resource_type: 'image',\n    unique_filename: true,\n    overwrite: true,\n  };\n\n  if (publicId) {\n    options.public_id = publicId;\n  }\n\n  const result: UploadApiResponse = await cloudinary.uploader.upload(file, options);\n\n  return {\n    url: result.secure_url,\n    publicId: result.public_id,\n    format: result.format,\n    width: result.width,\n    height: result.height,\n    bytes: result.bytes,\n  };\n}\n\n/**\n * Upload image from buffer (file upload)\n */\nexport async function uploadImageBuffer(\n  buffer: Buffer,\n  folder: UploadFolder,\n  originalName?: string\n): Promise<UploadResult> {\n  return new Promise((resolve, reject) => {\n    const options: UploadApiOptions = {\n      ...folderOptions[folder],\n      resource_type: 'image',\n      unique_filename: true,\n    };\n\n    const uploadStream = cloudinary.uploader.upload_stream(\n      options,\n      (error, result) => {\n        if (error) {\n          reject(error);\n        } else if (result) {\n          resolve({\n            url: result.secure_url,\n            publicId: result.public_id,\n            format: result.format,\n            width: result.width,\n            height: result.height,\n            bytes: result.bytes,\n          });\n        }\n      }\n    );\n\n    uploadStream.end(buffer);\n  });\n}\n\n/**\n * Delete image by public ID\n */\nexport async function deleteImage(publicId: string): Promise<boolean> {\n  try {\n    const result = await cloudinary.uploader.destroy(publicId);\n    return result.result === 'ok';\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get optimized URL for an image\n */\nexport function getOptimizedUrl(\n  publicId: string,\n  options?: {\n    width?: number;\n    height?: number;\n    crop?: string;\n  }\n): string {\n  return cloudinary.url(publicId, {\n    secure: true,\n    quality: 'auto',\n    format: 'auto',\n    ...options,\n  });\n}\n\nexport { cloudinary };\n","// Upload Service\nimport { prisma } from '../config/database';\nimport {\n  uploadImage,\n  uploadImageBuffer,\n  deleteImage,\n  type UploadFolder,\n} from '../config/cloudinary';\nimport { NotFoundError, BadRequestError, ForbiddenError } from '../utils/errors';\nimport type { UploadType } from '@prisma/client';\n\nexport interface UploadResponse {\n  id: string;\n  userId: string;\n  type: UploadType;\n  url: string;\n  publicId: string;\n  format: string;\n  width: number | null;\n  height: number | null;\n  bytes: number | null;\n  originalName: string | null;\n  createdAt: Date;\n}\n\n// Map upload type to Cloudinary folder\nconst typeToFolder: Record<UploadType, UploadFolder> = {\n  AVATAR: 'avatars',\n  VENDOR_IMAGE: 'vendors',\n  MENU_IMAGE: 'menus',\n  BANNER: 'banners',\n  REVIEW_IMAGE: 'reviews',\n};\n\n/**\n * Upload file from base64 or URL\n */\nexport async function uploadFile(\n  userId: string,\n  type: UploadType,\n  file: string,\n  originalName?: string\n): Promise<UploadResponse> {\n  const folder = typeToFolder[type];\n\n  const result = await uploadImage(file, folder);\n\n  const upload = await prisma.upload.create({\n    data: {\n      userId,\n      type,\n      url: result.url,\n      publicId: result.publicId,\n      format: result.format,\n      width: result.width,\n      height: result.height,\n      bytes: result.bytes,\n      originalName,\n    },\n  });\n\n  return upload;\n}\n\n/**\n * Upload file from buffer (multipart form)\n */\nexport async function uploadFileBuffer(\n  userId: string,\n  type: UploadType,\n  buffer: Buffer,\n  originalName?: string\n): Promise<UploadResponse> {\n  const folder = typeToFolder[type];\n\n  const result = await uploadImageBuffer(buffer, folder, originalName);\n\n  const upload = await prisma.upload.create({\n    data: {\n      userId,\n      type,\n      url: result.url,\n      publicId: result.publicId,\n      format: result.format,\n      width: result.width,\n      height: result.height,\n      bytes: result.bytes,\n      originalName,\n    },\n  });\n\n  return upload;\n}\n\n/**\n * Delete upload\n */\nexport async function deleteUpload(\n  uploadId: string,\n  userId: string,\n  isAdmin: boolean = false\n): Promise<void> {\n  const upload = await prisma.upload.findUnique({\n    where: { id: uploadId },\n  });\n\n  if (!upload) {\n    throw new NotFoundError('Upload');\n  }\n\n  if (upload.userId !== userId && !isAdmin) {\n    throw new ForbiddenError('Not authorized to delete this upload');\n  }\n\n  // Delete from Cloudinary\n  await deleteImage(upload.publicId);\n\n  // Delete from database\n  await prisma.upload.delete({ where: { id: uploadId } });\n}\n\n/**\n * Get uploads for a user\n */\nexport async function getUserUploads(\n  userId: string,\n  type?: UploadType\n): Promise<UploadResponse[]> {\n  const where: any = { userId };\n\n  if (type) {\n    where.type = type;\n  }\n\n  return prisma.upload.findMany({\n    where,\n    orderBy: { createdAt: 'desc' },\n  });\n}\n\n/**\n * Get upload by ID\n */\nexport async function getUploadById(uploadId: string): Promise<UploadResponse> {\n  const upload = await prisma.upload.findUnique({\n    where: { id: uploadId },\n  });\n\n  if (!upload) {\n    throw new NotFoundError('Upload');\n  }\n\n  return upload;\n}\n\n/**\n * Upload avatar and update user\n */\nexport async function uploadAvatar(\n  userId: string,\n  file: string\n): Promise<UploadResponse> {\n  const upload = await uploadFile(userId, 'AVATAR', file);\n\n  // Update user avatar\n  await prisma.user.update({\n    where: { id: userId },\n    data: { avatar: upload.url },\n  });\n\n  return upload;\n}\n\n/**\n * Upload vendor image and update vendor\n */\nexport async function uploadVendorImage(\n  userId: string,\n  vendorId: string,\n  file: string\n): Promise<UploadResponse> {\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  if (vendor.userId !== userId) {\n    throw new ForbiddenError('Not authorized to update this vendor');\n  }\n\n  const upload = await uploadFile(userId, 'VENDOR_IMAGE', file);\n\n  // Update vendor image\n  await prisma.vendor.update({\n    where: { id: vendorId },\n    data: { image: upload.url },\n  });\n\n  return upload;\n}\n\n/**\n * Upload menu item image and update menu item\n */\nexport async function uploadMenuItemImage(\n  userId: string,\n  menuItemId: string,\n  file: string\n): Promise<UploadResponse> {\n  const menuItem = await prisma.menuItem.findUnique({\n    where: { id: menuItemId },\n    include: { vendor: true },\n  });\n\n  if (!menuItem) {\n    throw new NotFoundError('Menu item');\n  }\n\n  if (menuItem.vendor.userId !== userId) {\n    throw new ForbiddenError('Not authorized to update this menu item');\n  }\n\n  const upload = await uploadFile(userId, 'MENU_IMAGE', file);\n\n  // Update menu item image\n  await prisma.menuItem.update({\n    where: { id: menuItemId },\n    data: { image: upload.url },\n  });\n\n  return upload;\n}\n\n/**\n * Validate file type\n */\nexport function validateFileType(\n  mimeType: string,\n  allowedTypes: string[] = ['image/jpeg', 'image/png', 'image/webp', 'image/gif']\n): boolean {\n  return allowedTypes.includes(mimeType);\n}\n\n/**\n * Validate file size (default 5MB)\n */\nexport function validateFileSize(\n  bytes: number,\n  maxSizeBytes: number = 5 * 1024 * 1024\n): boolean {\n  return bytes <= maxSizeBytes;\n}\n","// Upload Controller\nimport { Elysia, t } from 'elysia';\nimport { bearer } from '@elysiajs/bearer';\nimport * as uploadService from '../services/upload.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport { success } from '../utils/response';\nimport { BadRequestError, UnauthorizedError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\nexport const uploadController = new Elysia({ prefix: '/uploads' })\n  .use(bearer())\n\n  // Upload image (base64 or URL)\n  .post(\n    '/',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n\n      if (!body.file) {\n        throw new BadRequestError('File is required');\n      }\n\n      const upload = await uploadService.uploadFile(\n        user.id,\n        body.type as any,\n        body.file,\n        body.originalName\n      );\n\n      return success(upload, 'File uploaded successfully');\n    },\n    {\n      body: t.Object({\n        type: t.Union([\n          t.Literal('AVATAR'),\n          t.Literal('VENDOR_IMAGE'),\n          t.Literal('MENU_IMAGE'),\n          t.Literal('BANNER'),\n          t.Literal('REVIEW_IMAGE'),\n        ]),\n        file: t.String(), // base64 or URL\n        originalName: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Upload file',\n        description: 'Upload file from base64 or URL',\n      },\n    }\n  )\n\n  // Upload avatar\n  .post(\n    '/avatar',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n\n      if (!body.file) {\n        throw new BadRequestError('File is required');\n      }\n\n      const upload = await uploadService.uploadAvatar(user.id, body.file);\n      return success(upload, 'Avatar uploaded successfully');\n    },\n    {\n      body: t.Object({\n        file: t.String(),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Upload avatar',\n        description: 'Upload user avatar',\n      },\n    }\n  )\n\n  // Upload vendor image\n  .post(\n    '/vendor/:vendorId',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n\n      if (!body.file) {\n        throw new BadRequestError('File is required');\n      }\n\n      const upload = await uploadService.uploadVendorImage(\n        user.id,\n        params.vendorId,\n        body.file\n      );\n      return success(upload, 'Vendor image uploaded successfully');\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      body: t.Object({\n        file: t.String(),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Upload vendor image',\n        description: 'Upload vendor shop image',\n      },\n    }\n  )\n\n  // Upload menu item image\n  .post(\n    '/menu/:menuItemId',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n\n      if (!body.file) {\n        throw new BadRequestError('File is required');\n      }\n\n      const upload = await uploadService.uploadMenuItemImage(\n        user.id,\n        params.menuItemId,\n        body.file\n      );\n      return success(upload, 'Menu item image uploaded successfully');\n    },\n    {\n      params: t.Object({\n        menuItemId: t.String(),\n      }),\n      body: t.Object({\n        file: t.String(),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Upload menu image',\n        description: 'Upload menu item image',\n      },\n    }\n  )\n\n  // Get my uploads\n  .get(\n    '/me',\n    async ({ request, query }) => {\n      const user = await getAuthUser(request);\n\n      const uploads = await uploadService.getUserUploads(\n        user.id,\n        query.type as any\n      );\n      return success(uploads);\n    },\n    {\n      query: t.Object({\n        type: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Get my uploads',\n        description: 'Get current user uploads',\n      },\n    }\n  )\n\n  // Get upload by ID\n  .get(\n    '/:uploadId',\n    async ({ params }) => {\n      const upload = await uploadService.getUploadById(params.uploadId);\n      return success(upload);\n    },\n    {\n      params: t.Object({\n        uploadId: t.String(),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Get upload',\n        description: 'Get upload details',\n      },\n    }\n  )\n\n  // Delete upload\n  .delete(\n    '/:uploadId',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n\n      await uploadService.deleteUpload(\n        params.uploadId,\n        user.id,\n        user.role === 'ADMIN'\n      );\n      return success(null, 'Upload deleted');\n    },\n    {\n      params: t.Object({\n        uploadId: t.String(),\n      }),\n      detail: {\n        tags: ['Uploads'],\n        summary: 'Delete upload',\n        description: 'Delete an upload',\n      },\n    }\n  );\n","// Review Service\nimport { prisma } from '../config/database';\nimport { NotFoundError, ForbiddenError, BadRequestError } from '../utils/errors';\nimport { parsePagination, createPaginationMeta } from '../utils/response';\nimport type { PaginationInput } from '../utils/validation';\nimport type { Role } from '@prisma/client';\n\nexport interface ReviewResponse {\n  id: string;\n  userId: string;\n  vendorId: string;\n  rating: number;\n  comment: string | null;\n  images: string[];\n  createdAt: Date;\n  updatedAt: Date;\n  user?: {\n    id: string;\n    name: string;\n    avatar: string | null;\n  };\n  vendor?: {\n    id: string;\n    name: string;\n    image: string | null;\n  };\n}\n\nexport interface CreateReviewInput {\n  vendorId: string;\n  rating: number;\n  comment?: string;\n  images?: string[];\n}\n\nexport interface UpdateReviewInput {\n  rating?: number;\n  comment?: string;\n  images?: string[];\n}\n\nexport interface ReviewStats {\n  averageRating: number;\n  totalReviews: number;\n  ratingDistribution: {\n    1: number;\n    2: number;\n    3: number;\n    4: number;\n    5: number;\n  };\n}\n\n/**\n * Create a new review\n */\nexport async function createReview(\n  userId: string,\n  input: CreateReviewInput\n): Promise<ReviewResponse> {\n  // Validate rating\n  if (input.rating < 1 || input.rating > 5) {\n    throw new BadRequestError('Rating must be between 1 and 5');\n  }\n\n  // Check if vendor exists\n  const vendor = await prisma.vendor.findUnique({\n    where: { id: input.vendorId },\n  });\n\n  if (!vendor) {\n    throw new NotFoundError('Vendor');\n  }\n\n  // Check if user has completed a reservation with this vendor\n  const hasCompletedReservation = await prisma.reservation.findFirst({\n    where: {\n      customerId: userId,\n      vendorId: input.vendorId,\n      status: 'COMPLETED',\n    },\n  });\n\n  if (!hasCompletedReservation) {\n    throw new BadRequestError('You can only review vendors you have ordered from');\n  }\n\n  // Check if user already reviewed this vendor\n  const existingReview = await prisma.review.findFirst({\n    where: {\n      userId,\n      vendorId: input.vendorId,\n    },\n  });\n\n  if (existingReview) {\n    throw new BadRequestError('You have already reviewed this vendor');\n  }\n\n  // Create review\n  const review = await prisma.review.create({\n    data: {\n      userId,\n      vendorId: input.vendorId,\n      rating: input.rating,\n      comment: input.comment,\n      images: input.images || [],\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          name: true,\n          avatar: true,\n        },\n      },\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n    },\n  });\n\n  // Update vendor rating\n  await updateVendorRating(input.vendorId);\n\n  return review;\n}\n\n/**\n * Update an existing review\n */\nexport async function updateReview(\n  reviewId: string,\n  userId: string,\n  userRole: Role,\n  input: UpdateReviewInput\n): Promise<ReviewResponse> {\n  const review = await prisma.review.findUnique({\n    where: { id: reviewId },\n  });\n\n  if (!review) {\n    throw new NotFoundError('Review');\n  }\n\n  // Check permission\n  if (review.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to update this review');\n  }\n\n  // Validate rating if provided\n  if (input.rating !== undefined && (input.rating < 1 || input.rating > 5)) {\n    throw new BadRequestError('Rating must be between 1 and 5');\n  }\n\n  const updated = await prisma.review.update({\n    where: { id: reviewId },\n    data: {\n      rating: input.rating,\n      comment: input.comment,\n      images: input.images,\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          name: true,\n          avatar: true,\n        },\n      },\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n    },\n  });\n\n  // Update vendor rating if rating changed\n  if (input.rating !== undefined) {\n    await updateVendorRating(review.vendorId);\n  }\n\n  return updated;\n}\n\n/**\n * Delete a review\n */\nexport async function deleteReview(\n  reviewId: string,\n  userId: string,\n  userRole: Role\n): Promise<void> {\n  const review = await prisma.review.findUnique({\n    where: { id: reviewId },\n  });\n\n  if (!review) {\n    throw new NotFoundError('Review');\n  }\n\n  // Check permission\n  if (review.userId !== userId && userRole !== 'ADMIN') {\n    throw new ForbiddenError('Not authorized to delete this review');\n  }\n\n  await prisma.review.delete({\n    where: { id: reviewId },\n  });\n\n  // Update vendor rating\n  await updateVendorRating(review.vendorId);\n}\n\n/**\n * Get review by ID\n */\nexport async function getReviewById(reviewId: string): Promise<ReviewResponse> {\n  const review = await prisma.review.findUnique({\n    where: { id: reviewId },\n    include: {\n      user: {\n        select: {\n          id: true,\n          name: true,\n          avatar: true,\n        },\n      },\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n    },\n  });\n\n  if (!review) {\n    throw new NotFoundError('Review');\n  }\n\n  return review;\n}\n\n/**\n * Get reviews for a vendor\n */\nexport async function getVendorReviews(\n  vendorId: string,\n  pagination: PaginationInput,\n  filters?: {\n    rating?: number;\n    sortBy?: 'newest' | 'oldest' | 'highest' | 'lowest';\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = { vendorId };\n\n  if (filters?.rating) {\n    where.rating = filters.rating;\n  }\n\n  // Determine sort order\n  let orderBy: any = { createdAt: 'desc' };\n  if (filters?.sortBy === 'oldest') {\n    orderBy = { createdAt: 'asc' };\n  } else if (filters?.sortBy === 'highest') {\n    orderBy = { rating: 'desc' };\n  } else if (filters?.sortBy === 'lowest') {\n    orderBy = { rating: 'asc' };\n  }\n\n  const [reviews, total] = await Promise.all([\n    prisma.review.findMany({\n      where,\n      include: {\n        user: {\n          select: {\n            id: true,\n            name: true,\n            avatar: true,\n          },\n        },\n      },\n      orderBy,\n      skip,\n      take: limit,\n    }),\n    prisma.review.count({ where }),\n  ]);\n\n  return {\n    items: reviews,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get user's reviews\n */\nexport async function getUserReviews(\n  userId: string,\n  pagination: PaginationInput\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const [reviews, total] = await Promise.all([\n    prisma.review.findMany({\n      where: { userId },\n      include: {\n        vendor: {\n          select: {\n            id: true,\n            name: true,\n            image: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      skip,\n      take: limit,\n    }),\n    prisma.review.count({ where: { userId } }),\n  ]);\n\n  return {\n    items: reviews,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get all reviews (admin)\n */\nexport async function getAllReviews(\n  pagination: PaginationInput,\n  filters?: {\n    vendorId?: string;\n    userId?: string;\n    rating?: number;\n  }\n) {\n  const { page, limit, skip } = parsePagination(pagination);\n\n  const where: any = {};\n\n  if (filters?.vendorId) {\n    where.vendorId = filters.vendorId;\n  }\n  if (filters?.userId) {\n    where.userId = filters.userId;\n  }\n  if (filters?.rating) {\n    where.rating = filters.rating;\n  }\n\n  const [reviews, total] = await Promise.all([\n    prisma.review.findMany({\n      where,\n      include: {\n        user: {\n          select: {\n            id: true,\n            name: true,\n            avatar: true,\n          },\n        },\n        vendor: {\n          select: {\n            id: true,\n            name: true,\n            image: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      skip,\n      take: limit,\n    }),\n    prisma.review.count({ where }),\n  ]);\n\n  return {\n    items: reviews,\n    meta: createPaginationMeta(page, limit, total),\n  };\n}\n\n/**\n * Get review statistics for a vendor\n */\nexport async function getVendorReviewStats(vendorId: string): Promise<ReviewStats> {\n  const reviews = await prisma.review.findMany({\n    where: { vendorId },\n    select: { rating: true },\n  });\n\n  const totalReviews = reviews.length;\n\n  if (totalReviews === 0) {\n    return {\n      averageRating: 0,\n      totalReviews: 0,\n      ratingDistribution: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 },\n    };\n  }\n\n  const ratingSum = reviews.reduce((sum, r) => sum + r.rating, 0);\n  const averageRating = Math.round((ratingSum / totalReviews) * 10) / 10;\n\n  const ratingDistribution = {\n    1: reviews.filter((r) => r.rating === 1).length,\n    2: reviews.filter((r) => r.rating === 2).length,\n    3: reviews.filter((r) => r.rating === 3).length,\n    4: reviews.filter((r) => r.rating === 4).length,\n    5: reviews.filter((r) => r.rating === 5).length,\n  };\n\n  return {\n    averageRating,\n    totalReviews,\n    ratingDistribution,\n  };\n}\n\n/**\n * Get recent reviews (for homepage)\n */\nexport async function getRecentReviews(limit: number = 10) {\n  const reviews = await prisma.review.findMany({\n    where: {\n      rating: { gte: 4 }, // Only show good reviews on homepage\n    },\n    include: {\n      user: {\n        select: {\n          id: true,\n          name: true,\n          avatar: true,\n        },\n      },\n      vendor: {\n        select: {\n          id: true,\n          name: true,\n          image: true,\n        },\n      },\n    },\n    orderBy: { createdAt: 'desc' },\n    take: limit,\n  });\n\n  return reviews;\n}\n\n/**\n * Check if user can review a vendor\n */\nexport async function canUserReviewVendor(\n  userId: string,\n  vendorId: string\n): Promise<{ canReview: boolean; reason?: string }> {\n  // Check if user has completed a reservation\n  const hasCompletedReservation = await prisma.reservation.findFirst({\n    where: {\n      customerId: userId,\n      vendorId,\n      status: 'COMPLETED',\n    },\n  });\n\n  if (!hasCompletedReservation) {\n    return {\n      canReview: false,\n      reason: 'You need to complete an order before reviewing',\n    };\n  }\n\n  // Check if already reviewed\n  const existingReview = await prisma.review.findFirst({\n    where: { userId, vendorId },\n  });\n\n  if (existingReview) {\n    return {\n      canReview: false,\n      reason: 'You have already reviewed this vendor',\n    };\n  }\n\n  return { canReview: true };\n}\n\n/**\n * Update vendor's average rating\n */\nasync function updateVendorRating(vendorId: string): Promise<void> {\n  const stats = await getVendorReviewStats(vendorId);\n\n  await prisma.vendor.update({\n    where: { id: vendorId },\n    data: { rating: stats.averageRating },\n  });\n}\n\n/**\n * Get top rated vendors\n */\nexport async function getTopRatedVendors(limit: number = 5) {\n  const vendors = await prisma.vendor.findMany({\n    where: {\n      isOpen: true,\n      rating: { gt: 0 },\n    },\n    include: {\n      _count: {\n        select: { reviews: true },\n      },\n    },\n    orderBy: [{ rating: 'desc' }, { totalOrders: 'desc' }],\n    take: limit,\n  });\n\n  return vendors.map((v) => ({\n    id: v.id,\n    name: v.name,\n    image: v.image,\n    rating: v.rating,\n    totalReviews: v._count.reviews,\n    totalOrders: v.totalOrders,\n  }));\n}\n","// Review Controller\nimport { Elysia, t } from 'elysia';\nimport { bearer } from '@elysiajs/bearer';\nimport * as reviewService from '../services/review.service';\nimport { validateSession, type AuthUser } from '../services/auth.service';\nimport { requireAuth, requireAdmin } from '../middlewares/auth.middleware';\nimport { success, paginated } from '../utils/response';\nimport { paginationSchema } from '../utils/validation';\nimport { BadRequestError, UnauthorizedError } from '../utils/errors';\n\n// Helper function to extract and validate auth\nasync function getAuthUser(request: Request): Promise<AuthUser> {\n  const authHeader = request.headers.get('authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    throw new UnauthorizedError('Authentication required');\n  }\n\n  const token = authHeader.slice(7);\n  const user = await validateSession(token);\n\n  if (!user) {\n    throw new UnauthorizedError('Invalid or expired session');\n  }\n\n  return user;\n}\n\n// Optional auth - returns user if authenticated, null otherwise\nasync function getOptionalAuthUser(request: Request): Promise<AuthUser | null> {\n  try {\n    return await getAuthUser(request);\n  } catch {\n    return null;\n  }\n}\n\nexport const reviewController = new Elysia({ prefix: '/reviews' })\n  .use(bearer())\n\n  // Get recent reviews (public - for homepage)\n  .get(\n    '/recent',\n    async ({ query }) => {\n      const limit = query.limit ? parseInt(query.limit) : 10;\n      const reviews = await reviewService.getRecentReviews(limit);\n      return success(reviews);\n    },\n    {\n      query: t.Object({\n        limit: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get recent reviews',\n        description: 'Get recent positive reviews for homepage',\n      },\n    }\n  )\n\n  // Get top rated vendors (public)\n  .get(\n    '/top-vendors',\n    async ({ query }) => {\n      const limit = query.limit ? parseInt(query.limit) : 5;\n      const vendors = await reviewService.getTopRatedVendors(limit);\n      return success(vendors);\n    },\n    {\n      query: t.Object({\n        limit: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get top rated vendors',\n        description: 'Get vendors with highest ratings',\n      },\n    }\n  )\n\n  // Get review by ID (public)\n  .get(\n    '/:reviewId',\n    async ({ params }) => {\n      const review = await reviewService.getReviewById(params.reviewId);\n      return success(review);\n    },\n    {\n      params: t.Object({\n        reviewId: t.String(),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get review',\n        description: 'Get review details',\n      },\n    }\n  )\n\n  // Create review (authenticated)\n  .post(\n    '/',\n    async ({ request, body }) => {\n      const user = await getAuthUser(request);\n\n      if (!body.vendorId || !body.rating) {\n        throw new BadRequestError('Vendor ID and rating are required');\n      }\n\n      const review = await reviewService.createReview(user.id, {\n        vendorId: body.vendorId,\n        rating: body.rating,\n        comment: body.comment,\n        images: body.images,\n      });\n\n      return success(review, 'Review created successfully');\n    },\n    {\n      body: t.Object({\n        vendorId: t.String(),\n        rating: t.Number({ minimum: 1, maximum: 5 }),\n        comment: t.Optional(t.String()),\n        images: t.Optional(t.Array(t.String())),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Create review',\n        description: 'Create a new review for a vendor',\n      },\n    }\n  )\n\n  // Update review (authenticated)\n  .patch(\n    '/:reviewId',\n    async ({ request, params, body }) => {\n      const user = await getAuthUser(request);\n\n      const review = await reviewService.updateReview(\n        params.reviewId,\n        user.id,\n        user.role,\n        body\n      );\n\n      return success(review, 'Review updated successfully');\n    },\n    {\n      params: t.Object({\n        reviewId: t.String(),\n      }),\n      body: t.Object({\n        rating: t.Optional(t.Number({ minimum: 1, maximum: 5 })),\n        comment: t.Optional(t.String()),\n        images: t.Optional(t.Array(t.String())),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Update review',\n        description: 'Update an existing review',\n      },\n    }\n  )\n\n  // Delete review (authenticated)\n  .delete(\n    '/:reviewId',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n\n      await reviewService.deleteReview(params.reviewId, user.id, user.role);\n\n      return success(null, 'Review deleted successfully');\n    },\n    {\n      params: t.Object({\n        reviewId: t.String(),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Delete review',\n        description: 'Delete a review',\n      },\n    }\n  )\n\n  // Get my reviews (authenticated)\n  .get(\n    '/me',\n    async ({ request, query }) => {\n      const user = await getAuthUser(request);\n\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n\n      const result = await reviewService.getUserReviews(user.id, paginationData);\n      return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get my reviews',\n        description: 'Get current user reviews',\n      },\n    }\n  )\n\n  // Check if user can review vendor (authenticated)\n  .get(\n    '/can-review/:vendorId',\n    async ({ request, params }) => {\n      const user = await getAuthUser(request);\n      const result = await reviewService.canUserReviewVendor(user.id, params.vendorId);\n      return success(result);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Check if can review',\n        description: 'Check if current user can review a vendor',\n      },\n    }\n  )\n\n  // Admin routes\n  .use(requireAdmin)\n\n  // Get all reviews (admin)\n  .get(\n    '/',\n    async ({ query }) => {\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n\n      const result = await reviewService.getAllReviews(paginationData, {\n        vendorId: query.vendorId,\n        userId: query.userId,\n        rating: query.rating ? parseInt(query.rating) : undefined,\n      });\n\n      return paginated(result);\n    },\n    {\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        vendorId: t.Optional(t.String()),\n        userId: t.Optional(t.String()),\n        rating: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get all reviews',\n        description: 'Get all reviews (admin only)',\n      },\n    }\n  );\n\n// Vendor Reviews Routes (nested under vendors)\nexport const vendorReviewsController = new Elysia({\n  prefix: '/vendors/:vendorId/reviews',\n})\n  .use(bearer())\n\n  // Get vendor reviews (public)\n  .get(\n    '/',\n    async ({ params, query }) => {\n      const pagination = paginationSchema.safeParse(query);\n      const paginationData = pagination.success ? pagination.data : { page: 1, limit: 20 };\n\n      const result = await reviewService.getVendorReviews(\n        params.vendorId,\n        paginationData,\n        {\n          rating: query.rating ? parseInt(query.rating) : undefined,\n          sortBy: query.sortBy as any,\n        }\n      );\n\n      return paginated(result);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      query: t.Object({\n        page: t.Optional(t.String()),\n        limit: t.Optional(t.String()),\n        rating: t.Optional(t.String()),\n        sortBy: t.Optional(t.String()),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get vendor reviews',\n        description: 'Get all reviews for a vendor',\n      },\n    }\n  )\n\n  // Get vendor review stats (public)\n  .get(\n    '/stats',\n    async ({ params }) => {\n      const stats = await reviewService.getVendorReviewStats(params.vendorId);\n      return success(stats);\n    },\n    {\n      params: t.Object({\n        vendorId: t.String(),\n      }),\n      detail: {\n        tags: ['Reviews'],\n        summary: 'Get vendor review stats',\n        description: 'Get review statistics for a vendor',\n      },\n    }\n  );\n","// Entry Point - Full API with Elysia + Bun.serve\nimport \"dotenv/config\";\nimport { Elysia } from \"elysia\";\nimport { cors } from \"@elysiajs/cors\";\nimport { openapi } from \"@elysiajs/openapi\";\nimport logixlysia from \"logixlysia\";\n// Import controllers\nimport {\n  authController,\n  passwordResetController,\n} from \"./controllers/auth.controller\";\nimport { userController } from \"./controllers/user.controller\";\nimport { apiKeyController } from \"./controllers/apikey.controller\";\nimport { vendorController } from \"./controllers/vendor.controller\";\nimport {\n  menuController,\n  vendorMenuController,\n} from \"./controllers/menu.controller\";\nimport {\n  reservationController,\n  vendorReservationsController,\n} from \"./controllers/reservation.controller\";\nimport { timeSlotController } from \"./controllers/timeslot.controller\";\nimport { uploadController } from \"./controllers/upload.controller\";\nimport {\n  reviewController,\n  vendorReviewsController,\n} from \"./controllers/review.controller\";\nimport {\n  formatErrorResponse,\n  getErrorStatusCode,\n  AppError,\n} from \"./utils/errors\";\n\nconst PORT = Number(process.env.PORT) || 3002;\nconst NODE_ENV = process.env.NODE_ENV || \"development\";\nconst FRONTEND_URL = process.env.FRONTEND_URL || \"http://localhost:3000\";\n\n// Create Elysia app\nconst app = new Elysia()\n  // Global error handler\n  .onError(({ code, error, set }) => {\n    console.error(`[Error] ${code}:`, error);\n\n    // Handle known errors\n    if (error instanceof AppError) {\n      set.status = error.statusCode;\n      return formatErrorResponse(error);\n    }\n\n    // Handle validation errors\n    if (code === \"VALIDATION\") {\n      set.status = 400;\n      return {\n        success: false,\n        error: \"Validation failed\",\n        code: \"VALIDATION_ERROR\",\n        details: error.message,\n      };\n    }\n\n    // Handle not found\n    if (code === \"NOT_FOUND\") {\n      set.status = 404;\n      return {\n        success: false,\n        error: \"Route not found\",\n        code: \"NOT_FOUND\",\n      };\n    }\n\n    // Default error response\n    set.status = getErrorStatusCode(error);\n    return formatErrorResponse(error);\n  })\n  // CORS\n  .use(\n    cors({\n      origin:\n        NODE_ENV === \"production\"\n          ? FRONTEND_URL\n          : [\"http://localhost:3000\", `http://localhost:${PORT}`],\n      credentials: true,\n      allowedHeaders: [\n        \"Content-Type\",\n        \"Authorization\",\n        \"X-API-Key\",\n        \"X-Requested-With\",\n      ],\n      methods: [\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"],\n    })\n  )\n\n  // logging\n  .use(\n    logixlysia({\n      config: {\n        showStartupMessage: true,\n        startupMessageFormat: \"banner\",\n        timestamp: {\n          translateTime: \"yyyy-mm-dd HH:MM:ss\",\n        },\n        ip: true,\n        customLogFormat:\n          \"ü¶ä {now} {level} {duration} {method} {pathname} {status}\",\n      },\n    })\n  )\n\n  // Openapi documentation\n  .use(openapi({ path: \"/docs\" }))\n\n  // Health check\n  .get(\"/health\", () => ({\n    success: true,\n    data: {\n      status: \"healthy\",\n      timestamp: new Date().toISOString(),\n      version: \"1.0.0\",\n    },\n  }))\n\n  // API Routes\n  .group(\"/api\", (app) =>\n    app\n      .use(authController)\n      .use(passwordResetController)\n      .use(userController)\n      .use(apiKeyController)\n      .use(vendorController)\n      .use(menuController)\n      .use(vendorMenuController)\n      .use(reservationController)\n      .use(vendorReservationsController)\n      .use(timeSlotController)\n      .use(uploadController)\n      .use(reviewController)\n      .use(vendorReviewsController)\n  )\n\n  // 404 handler\n  .all(\n    \"*\",\n    ({ set }) => {\n      set.status = 404;\n      return {\n        success: false,\n        error: \"Endpoint not found\",\n        code: \"NOT_FOUND\",\n      };\n    },\n    {\n      detail: {\n        hide: true,\n      },\n    }\n  );\n\n// Use Bun.serve with Elysia's fetch handler\n// const server = Bun.serve({\n//   port: PORT,\n//   fetch: app.fetch,\n// });\n\n// app.listen({\n//   port: PORT,\n// });\n\n// console.log(`\n// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n// ‚ïë                                                            ‚ïë\n// ‚ïë   üçî Food Queue Reservation API                            ‚ïë\n// ‚ïë                                                            ‚ïë\n// ‚ïë   Server running on: http://localhost:${PORT}                 ‚ïë\n// ‚ïë   Swagger docs:      http://localhost:${PORT}/docs            ‚ïë\n// ‚ïë   Environment:       ${NODE_ENV.padEnd(30)}        ‚ïë\n// ‚ïë                                                            ‚ïë\n// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n// `);\n"],"mappings":"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"}